<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<link rel="icon" type="image/x-icon" href="favicon.ico">
<title>mod_cluster Documentation</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body id="High_Availability_Guide" class="book toc2 toc-left">
<div id="header">
<h1>mod_cluster Documentation</h1>
<div class="details">
<span id="revdate">2024-11-11</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">mod_cluster</div>
<ul class="sectlevel1">
<li><a href="#overview">1. Overview</a>
<ul class="sectlevel2">
<li><a href="#support-matrix">1.1. Support Matrix</a></li>
<li><a href="#platforms">1.2. Platforms</a></li>
<li><a href="#advantages">1.3. Advantages</a></li>
<li><a href="#requirements">1.4. Requirements</a></li>
<li><a href="#limitations">1.5. Limitations</a></li>
<li><a href="#downloads">1.6. Downloads</a></li>
<li><a href="#configuration">1.7. Configuration</a></li>
<li><a href="#migration">1.8. Migration from mod_jk or mod_proxy</a></li>
<li><a href="#ssl-support">1.9. SSL support</a></li>
</ul>
</li>
<li><a href="#quick-start-guide">2. Quick Start Guide</a>
<ul class="sectlevel2">
<li><a href="#download-mod_cluster-components">2.1. Download mod_cluster components</a></li>
<li><a href="#install-the-httpd-binary">2.2. Install the httpd binary</a></li>
<li><a href="#configure-httpd">2.3. Configure httpd</a></li>
<li><a href="#install-the-worker-side-binaries">2.4. Install the worker-side binaries</a></li>
<li><a href="#configuring-the-server-side">2.5. Configuring the server-side</a></li>
<li><a href="#experiment-with-the-load-balancing-demo-application">2.6. Experiment with the Load Balancing Demo Application</a></li>
</ul>
</li>
<li><a href="#container-integration-configuration">3. Container Integration Configuration</a>
<ul class="sectlevel2">
<li><a href="#jboss-as">3.1. JBoss AS</a></li>
<li><a href="#jboss-web-tomcat">3.2. JBoss Web &amp; Tomcat</a></li>
<li><a href="#as7-modcluster-subsystem-configuration">3.3. AS7 modcluster subsystem Configuration</a></li>
<li><a href="#modcluster-subsystem-configuration">3.4. ModCluster Subsystem configuration</a></li>
<li><a href="#building-worker-side-components">3.5. Building worker-side Components</a></li>
<li><a href="#worker-side-load-metrics">3.6. Worker-side Load Metrics</a></li>
<li><a href="#installing-worker-side-components">3.7. Installing Worker-side Components</a></li>
</ul>
</li>
<li><a href="#httpd">4. httpd configuration</a>
<ul class="sectlevel2">
<li><a href="#apache-httpd-configuration">4.1. Apache httpd configuration</a></li>
<li><a href="#mod_proxy-configuration">4.2. mod_proxy configuration</a></li>
<li><a href="#mod_slotmemmod_cluster_slotmem-configuration">4.3. mod_slotmem/mod_cluster_slotmem configuration</a></li>
<li><a href="#mod_proxy_cluster">4.4. mod_proxy_cluster</a></li>
<li><a href="#mod_manager">4.5. mod_manager</a></li>
<li><a href="#minimal-example">4.6. Minimal Example</a></li>
<li><a href="#building-httpd-modules">4.7. Building httpd modules</a></li>
</ul>
</li>
<li><a href="#security-configuration">5. Security configuration</a>
<ul class="sectlevel2">
<li><a href="#using-ssl-in-mod_cluster">5.1. Using SSL in mod_cluster</a></li>
</ul>
</li>
<li><a href="#demo">6. Load Balancing Demo Application</a>
<ul class="sectlevel2">
<li><a href="#overview-2">6.1. Overview</a></li>
<li><a href="#basic-usage">6.2. Basic Usage</a></li>
<li><a href="#client-driver-configuration-options">6.3. Client Driver Configuration Options</a></li>
<li><a href="#load-generation-scenarios">6.4. Load Generation Scenarios</a></li>
</ul>
</li>
<li><a href="#faq">7. FAQ</a>
<ul class="sectlevel2">
<li><a href="#what-is-advertise">7.1. What is Advertise?</a></li>
<li><a href="#what-to-do-if-i-dont-want-to-use-advertise-udp-multicast">7.2. What to do if I don&#8217;t want to use Advertise (UDP multicast)</a></li>
<li><a href="#it-is-not-working-what-should-i-do">7.3. It is not working, what should I do?</a></li>
<li><a href="#i-started-mod_cluster-and-it-looks-like-its-using-only-one-of-the-workers">7.4. I started mod_cluster and it looks like it&#8217;s using only one of the workers?</a></li>
<li><a href="#keep-seeing-http1-1-501-method-not-implemented">7.5. Keep seeing "HTTP/1.1 501 Method Not Implemented"</a></li>
<li><a href="#redirect-is-not-working-tomcat-jbossweb">7.6. Redirect is not working (Tomcat, JBossWeb):</a></li>
<li><a href="#i-have-more-than-one-tomcatjbossweb-connector">7.7. I have more than one Tomcat/JBossWeb Connector</a></li>
<li><a href="#chrome-does-not-display-mod_cluster-manager-page">7.8. Chrome does not display /mod_cluster-manager page</a></li>
<li><a href="#how-do-i-use-mod_cluster-with-selinux">7.9. How do I use mod_cluster with SELinux?</a></li>
<li><a href="#how-do-i-change-status-message-frequency">7.10. How do I change STATUS message frequency?</a></li>
<li><a href="#how-can-i-debug-requests-in-undertow">7.11. How can I debug requests in Undertow?</a></li>
</ul>
</li>
<li><a href="#migration-2">8. Migration</a>
<ul class="sectlevel2">
<li><a href="#migration-from-mod_jk">8.1. Migration from mod_jk</a></li>
<li><a href="#migration-from-mod_proxy">8.2. Migration from mod_proxy</a></li>
</ul>
</li>
<li><a href="#developer-resources">9. Developer Resources</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>&#169; 2018-2024 mod_cluster contributors</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/modcluster_logo_600px.png" alt="modcluster logo 600px">
</div>
</div>
<!-- toc disabled -->
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This document is also available as a <a href="mod_cluster-v2-user-guide.pdf">PDF to download</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="link" href="#overview">1. Overview</a></h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="https://github.com/modcluster/docs.modcluster.io/edit/main/docs/src/main/asciidoc/introduction.adoc">Improve this page – edit on GitHub.</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Project mod_cluster is an intelligent load balancer. Like mod_jk and
mod_proxy, mod_cluster uses a communication channel to forward
requests from httpd to one of a set of application server nodes. Unlike
mod_jk and mod_proxy, mod_proxy_cluster leverages an additional connection
between the application server nodes and httpd. The application server
nodes use this connection to transmit server-side load balance factors
and lifecycle events back to httpd via a custom set of HTTP methods,
affectionately called the Mod-Cluster Management Protocol (MCMP). This
additional feedback channel allows mod_proxy_cluster to offer a level of
intelligence and granularity not found in other load balancing
solutions.</p>
</div>
<div class="paragraph">
<p>Within httpd, mod_proxy_cluster is implemented as a set of modules for httpd
with mod_proxy enabled. Much of the logic comes from mod_proxy, e.g.
mod_proxy_ajp provides all the AJP logic needed by mod_proxy_cluster.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the past, mod_proxy_cluster was named mod_cluster (version 1.3.x and older),
consisting of native and container implementations. The repositories of the two
implementations were separated, and the native part got the name mod_proxy_cluster, while
the former name mod_cluster is currently used for container implementation.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="support-matrix"><a class="link" href="#support-matrix">1.1. Support Matrix</a></h3>
<div class="sect3">
<h4 id="container-integration-modules"><a class="link" href="#container-integration-modules">1.1.1. Container Integration Modules</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Release</th>
<th class="tableblock halign-left valign-top">Tomcat versions</th>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">Documentation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>9.0</code>, <code>8.5</code> (EOL), <code>8.0</code> (EOL), <code>7.0</code> (EOL)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/modcluster/mod_cluster/tree/1.4.x">SCM Branch</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.modcluster.io/apidocs/1.4/">Javadoc</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10.1</code>, <code>9.0</code>, <code>8.5</code> (EOL)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/modcluster/mod_cluster/tree/2.0.x">SCM Branch</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.modcluster.io/apidocs/2.0/">Javadoc</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.1</code> (in development)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11.0</code>, <code>10.1</code>, <code>9.0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/modcluster/mod_cluster/tree/main">SCM Branch</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="apache-http-modules"><a class="link" href="#apache-http-modules">1.1.2. Apache HTTP modules</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Release</th>
<th class="tableblock halign-left valign-top">httpd versions</th>
<th class="tableblock halign-left valign-top">Code</th>
<th class="tableblock halign-left valign-top">Documentation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.4.49 and newer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/modcluster/mod_cluster/tree/1.3.x">SCM Branch</a></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2.0</code> (in development)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.4.53 and newer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/modcluster/mod_proxy_cluster/tree/main">SCM Branch</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.modcluster.io/apidocs/mpc-2.0/">Doxygen</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Complete documentation for legacy versions is archived at <a href="https://docs.modcluster.io/legacy/" class="bare">https://docs.modcluster.io/legacy/</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="platforms"><a class="link" href="#platforms">1.2. Platforms</a></h3>
<div class="paragraph">
<p>The binary packages of the modules needed to use with Apache httpd server are present in most distributions.</p>
</div>
<div class="paragraph">
<p>If your distribution doesn&#8217;t provide mod_proxy_cluster, pick the latest version from the source and follow
the building instructions.</p>
</div>
</div>
<div class="sect2">
<h3 id="advantages"><a class="link" href="#advantages">1.3. Advantages</a></h3>
<div class="paragraph">
<p>mod_proxy_cluster boasts the following advantages over other httpd-based load balancers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dynamic configuration of httpd workers</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Traditional httpd-based load balancers require explicit configuration of the workers available to a proxy.
In mod_proxy_cluster, the bulk of the proxy&#8217;s configuration resides on the application servers. The set of
proxies to which an application server will communicate is determined either by a static list or using dynamic
discovery via the advertising mechanism. The application server relays lifecycle events (e.g. server startup/shutdown)
to the proxies allowing them to effectively autoconfigure themselves. Notably, the graceful shutdown of a server
will not result in a failover response by a proxy, as is the case with traditional httpd-based load balancers.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Server-side load balance factor calculation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In contrast with traditional httpd-based load balancers, mod_proxy_cluster uses load balance factors calculated and
provided by the application servers rather than computing these in the proxy. Consequently, mod_proxy_cluster offers
a more robust and accurate set of load metrics than is available from the proxy (see Load Metrics for more).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fine-grained web-app lifecycle control</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Traditional httpd-based load balancers do not handle web application undeployments particularly well. From the proxy&#8217;s
perspective, requests to an undeployed web application are indistinguishable from a request for a non-existent
resource and will result in 404 errors. In mod_cluster, each server forwards any web application context lifecycle
events (e.g. web-app deploy/undeploy) to the proxy, informing it to start/stop routing requests for a given context to
that server.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AJP is optional</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Unlike mod_jk, mod_proxy_cluster does not require AJP. httpd connections to application server nodes can use HTTP, HTTPS, or AJP.
The original concepts are described in a <a href="developer/design.html">Design</a> article.</p>
</div>
</div>
<div class="sect2">
<h3 id="requirements"><a class="link" href="#requirements">1.4. Requirements</a></h3>
<div class="sect3">
<h4 id="balancer-side"><a class="link" href="#balancer-side">1.4.1. Balancer side</a></h4>
<div class="ulist">
<ul>
<li>
<p>Apache HTTP Server 2.4.53 and newer for mod_proxy_cluster 2.x</p>
</li>
<li>
<p>Apache HTTP Server 2.4.49 and newer for mod_proxy_cluster/mod_cluster 1.3.x</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="worker-side"><a class="link" href="#worker-side">1.4.2. Worker side</a></h4>
<div class="paragraph">
<p>The mod_cluster container integration module (implemented in Java) is provided for all the following containers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WildFly 8 and newer</p>
</li>
<li>
<p>JBoss AS 7</p>
</li>
<li>
<p>Tomcat 6 and newer</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="limitations"><a class="link" href="#limitations">1.5. Limitations</a></h3>
<div class="paragraph">
<p>mod_proxy_cluster uses shared memory to keep the nodes description, the shared memory is created at the start of httpd and
the structure of each item is fixed. The following cannot be changed by configuration directives.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Max Alias length 255 characters in 2.x, 100 characters in 1.3.x (Host: hostname header, Alias in&lt;Host/&gt;).</p>
</li>
<li>
<p>Max context length 80 (for example myapp.war deploys in /myapp/myapp is the context).</p>
</li>
<li>
<p>Max balancer name length 40 (balancer property in mbean).</p>
</li>
<li>
<p>Max JVMRoute string length is PROXY_WORKER_MAX_ROUTE_SIZE characters in 2.x, 64 characters in 1.3.x (JVMRoute in &lt;Engine/&gt;).</p>
</li>
<li>
<p>Max load balancing group name length 20 (domain property in mbean).</p>
</li>
<li>
<p>Max hostname length for a node 64 (address in the &lt;Connector/&gt;).</p>
</li>
<li>
<p>Max port length for a node 7 (8009 is 4 characters, port in the &lt;Connector/&gt;).</p>
</li>
<li>
<p>Max scheme length for a node 16 (possible values are http, https, ajp, liked with the protocol of &lt;Connector/&gt;).</p>
</li>
<li>
<p>Max cookie name 30 (the header cookie name for sessionid default value: <code>JSESSIONID</code> from <code>org.apache.catalina.Globals.SESSION_COOKIE_NAME</code>).</p>
</li>
<li>
<p>Max path name 30 (the parameter name for the sessionid default value: <code>jsessionid</code> from <code>org.apache.catalina.Globals.SESSION_PARAMETER_NAME</code>).</p>
</li>
<li>
<p>Max length for a sessionid 120 (something like BE81FAA969BF64C8EC2B6600457EAAAA.node01).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="downloads"><a class="link" href="#downloads">1.6. Downloads</a></h3>
<div class="paragraph">
<p>Download the latest <a href="https://modcluster.io/downloads/">mod_cluster release</a>.</p>
</div>
<div class="paragraph">
<p>The release contains the source to build the WildFly/JBoss AS/Tomcat Java distributions</p>
</div>
<div class="paragraph">
<p>The native part is developed in <a href="https://github.com/modcluster/mod_proxy_cluster" class="bare">https://github.com/modcluster/mod_proxy_cluster</a> (with 1.3.x version and older
available in the original repository <a href="https://github.com/modcluster/mod_cluster/tree/1.3.x" class="bare">https://github.com/modcluster/mod_cluster/tree/1.3.x</a>).
The native part is compatible with the 2.0.x and 1.4.x branches of mod_cluster</p>
</div>
<div class="paragraph">
<p>Alternatively, you can build from source using the <a href="https://github.com/modcluster/mod_cluster">mod_cluster git repository</a>
and <a href="https://github.com/modcluster/mod_proxy_cluster">mod_proxy_cluster git repository</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuration"><a class="link" href="#configuration">1.7. Configuration</a></h3>
<div class="paragraph">
<p>If you want to skip the details and just set up a minimal working
installation of mod_cluster, see the <a href="#quick-start-guide">Quick Start Guide</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Configuring <a href="#httpd">balancer</a></p>
</li>
<li>
<p>Configuring <a href="#container-integration-configuration">workers</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="migration"><a class="link" href="#migration">1.8. Migration from mod_jk or mod_proxy</a></h3>
<div class="paragraph">
<p>Migrating from mod_jk or mod_proxy is fairly straightforward. In general, much of the configuration previously
found in <code>httpd.conf</code> is now defined in the application server worker nodes.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Migrating from <a href="#migration-from-mod_jk">mod_jk</a></p>
</li>
<li>
<p>Migrating from <a href="#migration-from-mod_proxy">mod_proxy</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="ssl-support"><a class="link" href="#ssl-support">1.9. SSL support</a></h3>
<div class="paragraph">
<p>Both the request connections between httpd and the application server nodes, and the feedback channel
between the nodes and httpd can be secured. The former is achieved via the mod_proxy_https module and a corresponding
ssl-enabled HTTP connector in JBoss Web or Undertow. The latter requires the <a href="#using-ssl-in-mod_cluster">mod_ssl
module</a> and <a href="#ssl-configuration">explicit configuration in WildFly/JBoss AS/Web/Undertow</a>.</p>
</div>
<div class="paragraph">
<p>mod_cluster contains mod_ssl, therefore the warning (copied from OpenSSL <a href="https://www.openssl.org/">website</a>).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Strong cryptography: Please remember that export/import and/or use of strong cryptography software, providing
cryptography hooks, or even just communicating technical details about cryptography software is illegal in some parts
of the world. So when you import this package to your country, re-distribute it from there or even just email technical
suggestions or even source patches to the authors or other people you are strongly advised to pay close attention to
any laws or regulations which apply to you. The authors of openssl are not liable for any violations you make here. So
be careful, it is your responsibility.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="quick-start-guide"><a class="link" href="#quick-start-guide">2. Quick Start Guide</a></h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="https://github.com/modcluster/docs.modcluster.io/edit/main/docs/src/main/asciidoc/quickstart.adoc">Improve this page – edit on GitHub.</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Following are the steps to set up a minimal working installation of
mod_cluster on a single httpd server and a single back end server,
either JBoss AS, JBossWeb, Undertow or Tomcat. The steps can be repeated to add as
many httpd servers or back end servers to your cluster as desired.</p>
</div>
<div class="paragraph">
<p>The steps shown here are not intended to demonstrate how to set up a production
install of mod_proxy_cluster; for example, <a href="#using-ssl-in-mod_cluster">using SSL
to secure access</a> to the httpd-side mod_manager component is not covered. See the
<a href="#httpd">balancer-side</a> and <a href="#container-integration-configuration">worker-side</a>
configuration documentation for the full set of configuration options.</p>
</div>
<div class="sect2">
<h3 id="download-mod_cluster-components"><a class="link" href="#download-mod_cluster-components">2.1. Download mod_cluster components</a></h3>
<div class="paragraph">
<p>Download the latest httpd and java release bundles.
If there is no pre-built httpd bundle appropriate for your OS or system architecture,
you can <a href="#building-httpd-modules">build the Apache httpd binary from the source</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="install-the-httpd-binary"><a class="link" href="#install-the-httpd-binary">2.2. Install the httpd binary</a></h3>
<div class="sect3">
<h4 id="install-the-whole-httpd"><a class="link" href="#install-the-whole-httpd">2.2.1. Install the whole httpd</a></h4>
<div class="paragraph">
<p>Most of the standard distributions contain Apache httpd server. Use your platform&#8217;s
specific install tools to install. For example, in Fedora, just install as a root:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">dnf install httpd</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="install-only-the-mod_cluster-modules"><a class="link" href="#install-only-the-mod_cluster-modules">2.2.2. Install only the mod_cluster modules</a></h4>
<div class="paragraph">
<p>If you already have a working httpd install that you would prefer to
use and your distribution contains mod_cluster/mod_proxy_cluster just install it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">dnf install mod_cluster</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then you have the files below in your module directory:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mod_manager.so</p>
</li>
<li>
<p>mod_proxy_cluster.so</p>
</li>
<li>
<p>mod_advertise.so</p>
</li>
<li>
<p>mod_cluster_slotmem.so (only 1.3.x version)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>httpd version mismatch:</strong> <code>[warn] httpd version mismatch detected</code> Please,
beware that one cannot simply load the aforementioned modules into an arbitrary
httpd installation. These modules were built with a particular minor httpd
version, and they cannot be used with an older one.</p>
</div>
</div>
<div class="sect3">
<h4 id="install-in-windows"><a class="link" href="#install-in-windows">2.2.3. Install in Windows</a></h4>
<div class="paragraph">
<p>Unzip the bundle corresponding to your architecture.
Change to the bin directory of the subfolder <code>Apache24</code> where you unzipped the bundle.</p>
</div>
<div class="paragraph">
<p>You may run httpd directly by using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>httpd.exe</code></pre>
</div>
</div>
<div class="paragraph">
<p>or install Apache HTTP Server as a service:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>httpd.exe -k install -n myApache</code></pre>
</div>
</div>
<div class="paragraph">
<p>and start the service via net start or using httpd.exe:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>net start myApache</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>httpd.exe -k start</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configure-httpd"><a class="link" href="#configure-httpd">2.3. Configure httpd</a></h3>
<div class="paragraph">
<p>httpd.conf might need to be configured to use mod_proxy_cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>LoadModule proxy_module         modules/mod_proxy.so
LoadModule proxy_http_module    modules/mod_proxy_http.so
LoadModule proxy_ajp_module     modules/mod_proxy_ajp.so
LoadModule manager_module       modules/mod_manager.so
LoadModule proxy_cluster_module modules/mod_proxy_cluster.so
LoadModule advertise_module     modules/mod_advertise.so
LoadModule watchdog_module      modules/mod_watchdog.so
LoadModule slotmem_shm_module   modules/mod_slotmem_shm.so

&lt;IfModule manager_module&gt;
  Listen 127.0.0.1:6666
  ManagerBalancerName mycluster
  &lt;VirtualHost 127.0.0.1:6666&gt;
    &lt;Location /&gt;
     Require ip 127.0.0
    &lt;/Location&gt;

    EnableMCMPReceive
    &lt;Location /mod_cluster_manager&gt;
       SetHandler mod_cluster-manager
       Require ip 127.0.0
    &lt;/Location&gt;

  &lt;/VirtualHost&gt;
&lt;/IfModule&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For mod_proxy_cluster/mod_cluster 1.3.x you must load mod_cluster_slotmem module instead
of the httpd&#8217;s one. Simply change the line with <code>slotmem_shm_module</code> to following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>LoadModule cluster_slotmem_module modules/mod_cluster_slotmem.so</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="install-the-worker-side-binaries"><a class="link" href="#install-the-worker-side-binaries">2.4. Install the worker-side binaries</a></h3>
<div class="paragraph">
<p>Build the jar file using maven</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your next step depends on whether your target server is JBoss AS 7.x, Tomcat 8, 8.5/9.0 or 10.x or WildFly (Undertow).</p>
</div>
<div class="sect3">
<h4 id="installing-in-tomcat"><a class="link" href="#installing-in-tomcat">2.4.1. Installing in Tomcat</a></h4>
<div class="paragraph">
<p>Assuming $CATALINA_HOME indicates the root of your Tomcat install:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cp container/tomcat-[8.5,9.0,10.1]/target/*.jar $CATALINA_HOME/lib/
cp container/spi/target/*.jar $CATALINA_HOME/lib/
cp load-spi/target/*.jar $CATALINA_HOME/lib/
cp core/target/*.jar $CATALINA_HOME/lib/
cp dist/target/dependency/jboss-logging* $CATALINA_HOME/lib/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that you should copy only the tomcat files corresponding to your tomcat installation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>tomcat-8.5 for tomcat 8.5.x</p>
</li>
<li>
<p>tomcat-9.0 for tomcat 9.0.x</p>
</li>
<li>
<p>tomcat-10.1 for tomcat 10.0.x and 10.1.x</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="installing-in-wildfly"><a class="link" href="#installing-in-wildfly">2.4.2. Installing in WildFly</a></h4>
<div class="paragraph">
<p>WildFly already includes mod_cluster integration so no extra installation steps are necessary.
The mod_cluster subsystem is pre-configured in the HA configurations.
For WildFly-specific configuration refer to <a href="https://docs.wildfly.org/">WildFly documentation</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-the-server-side"><a class="link" href="#configuring-the-server-side">2.5. Configuring the server-side</a></h3>
<div class="sect3">
<h4 id="configuring-mod_cluster-with-jboss-as-5-x"><a class="link" href="#configuring-mod_cluster-with-jboss-as-5-x">2.5.1. Configuring mod_cluster with JBoss AS 5.x+</a></h4>
<div class="paragraph">
<p>No post-installation configuration necessary!</p>
</div>
</div>
<div class="sect3">
<h4 id="configuring-mod_cluster-with-standalone-jboss-web-or-tomcat"><a class="link" href="#configuring-mod_cluster-with-standalone-jboss-web-or-tomcat">2.5.2. Configuring mod_cluster with standalone JBoss Web or Tomcat</a></h4>
<div class="paragraph">
<p>Edit the <code>$CATALINA_HOME/conf/server.xml</code> file, adding the following next to the other <code>&lt;Listener/&gt;</code> elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;Listener</span> <span class="attribute-name">className</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.container.catalina.standalone.ModClusterListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">proxyList</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">127.0.0.1:6666</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="start-httpd"><a class="link" href="#start-httpd">2.5.3. Start httpd</a></h4>
<div class="paragraph">
<p>To start httpd do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/opt/jboss/httpd/sbin/apachectl start</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="start-the-back-end-server"><a class="link" href="#start-the-back-end-server">2.5.4. Start the back-end server</a></h4>
<div class="sect4">
<h5 id="starting-jboss-as"><a class="link" href="#starting-jboss-as">Starting JBoss AS</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd $JBOSS_HOME/bin
./run.sh -c all</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="starting-jbossweb-or-tomcat"><a class="link" href="#starting-jbossweb-or-tomcat">Starting JBossWeb or Tomcat</a></h5>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd $CATALINA_HOME
./startup.sh</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="set-up-more-back-end-servers"><a class="link" href="#set-up-more-back-end-servers">Set up more back-end servers</a></h5>
<div class="paragraph">
<p>Repeat the back-end server install and configuration steps for each
server in your cluster.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="experiment-with-the-load-balancing-demo-application"><a class="link" href="#experiment-with-the-load-balancing-demo-application">2.6. Experiment with the Load Balancing Demo Application</a></h3>
<div class="paragraph">
<p>See <a href="#demo">demo</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="container-integration-configuration"><a class="link" href="#container-integration-configuration">3. Container Integration Configuration</a></h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="https://github.com/modcluster/docs.modcluster.io/edit/main/docs/src/main/asciidoc/container-integration.adoc">Improve this page – edit on GitHub.</a>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="jboss-as"><a class="link" href="#jboss-as">3.1. JBoss AS</a></h3>
<div class="paragraph">
<p>mod_cluster is supported in AS7 via the modcluster subsystem See AS7 modcluster subsystem Configuration.</p>
</div>
<div class="paragraph">
<p>In JBoss AS 6 and older version mod_cluster&#8217;s configuration resides within the
following file:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$JBOSS_HOME/server/$PROFILE/deploy/mod_cluster.sar/META-INF/mod_cluster-jboss-beans.xml</pre>
</div>
</div>
<div class="paragraph">
<p>The entry point for mod_cluster&#8217;s server-side configuration is the <code>ModClusterListener</code> bean, which delegates web container
(e.g. JBoss Web) specific events to a container agnostic event handler.</p>
</div>
<div class="paragraph">
<p>In general, the <code>ModClusterListener</code> bean defines:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>A <code>ContainerEventHandler</code> in which to handle events from the web container.</p>
</li>
<li>
<p>A reference to the JBoss mbean server.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ModClusterListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.container.jbossweb.JBossWebEventHandlerAdapter</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;constructor&gt;</span>
    <span class="tag">&lt;parameter</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.container.ContainerEventHandler</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;inject</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ModClusterService</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/parameter&gt;</span>
    <span class="tag">&lt;parameter</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.management.MBeanServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;inject</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">JMXKernel</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mbeanServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/parameter&gt;</span>
  <span class="tag">&lt;/constructor&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="configuration-properties"><a class="link" href="#configuration-properties">3.1.1. Configuration Properties</a></h4>
<div class="paragraph">
<p>The <code>ModClusterConfig</code> bean enumerates the configuration properties used by mod_cluster.
For the complete list of configuration properties and their default values, see the chapter entitled
Server-side Configuration Properties.</p>
</div>
<div class="paragraph">
<p>e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ModClusterConfig</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.config.ModClusterConfig</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">On Demand</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="comment">&lt;!-- Specify configuration properties here --&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tomcat-connector"><a class="link" href="#tomcat-connector">3.1.2. Tomcat connector</a></h4>
<div class="paragraph">
<p>Like mod_jk and mod_proxy_balancer, mod_cluster requires a connector in your server.xml to which to forward web requests.
Unlike mod_jk and mod_proxy_balancer, mod_cluster is not confined to AJP, but can use HTTP as well. While AJP is generally
faster, an HTTP connector can optionally be secured via SSL.</p>
</div>
<div class="paragraph">
<p>Since mod_cluster 1.4, the connector registered with the balancer is no longer automatically chosen by mod_cluster and needs to be specified explicitly.
The new attributes <code>connectorPort</code> and/or <code>connectorAddress</code> need to be configured explicitly matching exactly one of the configured connectors, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;Listener</span> <span class="attribute-name">className</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.container.tomcat.ModClusterListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">connectorPort</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8009</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In mod_cluster version 1.3 and older, if multiple possible connectors are defined in your server.xml,
mod_cluster uses the following algorithm to choose between them:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If an native (APR) AJP connector is available, use it.</p>
</li>
<li>
<p>If an AJP connector is available, use it.</p>
</li>
<li>
<p>Otherwise, choose the HTTP connector with the highest max threads.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In case you are using <code>portOffset</code> on any connector you want to register with balancer, set <code>connectorPort</code> to the value of its <code>port</code> attribute.
Since 2.0.4.Final, the mod_cluster will handle the offset on its own.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="node-identity"><a class="link" href="#node-identity">3.1.3. Node Identity</a></h4>
<div class="paragraph">
<p>Like mod_jk and mod_proxy_balancer, mod_cluster identifies each node via a unique
<a href="http://docs.jboss.org/jbossweb/2.1.x/config/engine.html">jvm route</a>. By default, mod_cluster uses the following algorithm to
assign the jvm route for a given node:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the value from <code>server.xml</code>, <code>&lt;Engine jvmRoute="&#8230;&#8203;"/&gt;</code>, if defined.</p>
</li>
<li>
<p>Generate a jvm route using the configured TODO. The default implementation does the following:</p>
</li>
<li>
<p>Use the value of the <code>jboss.mod_cluster.jvmRoute</code> system property, if defined.</p>
</li>
<li>
<p>Generate a UUID.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>While UUIDs are ideal for production systems, in a development or testing environment, it is useful to know which node served
a given request just by looking at the jvm route. In this case, you can utilize the <code>org.jboss.modcluster.SimpleJvmRouteFactory</code>.
The factory generates jvm routes of the form:</p>
</div>
<div class="paragraph">
<p><strong>bind-address</strong>:*port*:*engine-name*</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="jboss-web-tomcat"><a class="link" href="#jboss-web-tomcat">3.2. JBoss Web &amp; Tomcat</a></h3>
<div class="paragraph">
<p>mod_cluster&#8217;s entire configuration for JBoss Web or Tomcat resides entirely within <code>$CATALINA_HOME/conf/server.xml</code>.</p>
</div>
<div class="paragraph">
<p>This limits the adds the following constraints to mod_cluster&#8217;s feature set:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Only non-clustered mode is supported</p>
</li>
<li>
<p>Only a single load metric can be used to calculate the load factor.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="lifecycle-listener"><a class="link" href="#lifecycle-listener">3.2.1. Lifecycle Listener</a></h4>
<div class="paragraph">
<p>The entry point for JBoss Web and Tomcat configuration is the ModClusterListener.
All mod_cluster configuration properties are defined as
attributes of the <code>&lt;Listener/&gt;</code> element. For the complete list of configuration properties and their default values, see
the chapter entitled "Server-side Configuration Properties".</p>
</div>
<div class="paragraph">
<p>e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;Listener</span> <span class="attribute-name">className</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.container.catalina.standalone.ModClusterListener</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">advertise</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="additional-tomcat-dependencies"><a class="link" href="#additional-tomcat-dependencies">3.2.2. Additional Tomcat dependencies</a></h4>
<div class="paragraph">
<p>mod_cluster uses jboss-logging, which exists in JBoss Web, but not in Tomcat. Consequently, to use mod_cluster with Tomcat,
it is necessary to add <a href="http://repository.jboss.org/nexus/content/groups/public-jboss/org/jboss/logging/jboss-logging-spi/">jboss-logging-spi.jar</a>
to <code>$CATALINA_HOME/lib</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="as7-modcluster-subsystem-configuration"><a class="link" href="#as7-modcluster-subsystem-configuration">3.3. AS7 modcluster subsystem Configuration</a></h3>
<div class="paragraph">
<p>JBoss Application Server 7+ mod_cluster subsystem configuration.</p>
</div>
<div class="sect3">
<h4 id="modcluster-subsystem-in-jboss-as7"><a class="link" href="#modcluster-subsystem-in-jboss-as7">3.3.1. ModCluster Subsystem in JBoss AS7</a></h4>
<div class="paragraph">
<p>The mod_cluster integration is done via the modcluster subsystem.</p>
</div>
</div>
<div class="sect3">
<h4 id="modcluster-subsystem-minimal-configuration"><a class="link" href="#modcluster-subsystem-minimal-configuration">3.3.2. ModCluster Subsystem minimal configuration</a></h4>
<div class="paragraph">
<p>The minimal configuration is having the modcluster <code>schemaLocation</code> in the <code>schemaLocation</code> list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;extension</span> <span class="attribute-name">module</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.as.modcluster</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and <code>subsystem</code> declaration like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:modcluster:2.0</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With that configuration modcluster will listen for advertise on <code>224.0.1.105:23364</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="modcluster-subsystem-configuration"><a class="link" href="#modcluster-subsystem-configuration">3.4. ModCluster Subsystem configuration</a></h3>
<div class="sect3">
<h4 id="mod-cluster-config-attributes"><a class="link" href="#mod-cluster-config-attributes">3.4.1. mod-cluster-config Attributes</a></h4>

</div>
<div class="sect3">
<h4 id="proxy-discovery-configuration"><a class="link" href="#proxy-discovery-configuration">3.4.2. Proxy Discovery Configuration</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy-list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxyList</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxyURL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertise</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertise</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertise-security-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertiseSecurityKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excluded-contexts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludedContexts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">auto-enable-contexts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoEnableContexts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stop-context-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stopContextTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 (in seconds)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">socket-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nodeTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20 (in seconds)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="proxy-configuration"><a class="link" href="#proxy-configuration">3.4.3. Proxy Configuration</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sticky-session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stickySession</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sticky-session-remove</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stickySessionRemove</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sticky-session-force</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stickySessionForce</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">node-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">workerTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max-attempts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxAttempts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flush-packets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flushPackets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flush-wait</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flushWait</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">smax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">smax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1 (it uses default value)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ttl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ttl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1 (it uses default value)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loadBalancingGroup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">load-balancing-group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loadBalancingGroup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="ssl-configuration"><a class="link" href="#ssl-configuration">3.4.4. SSL Configuration</a></h4>

</div>
<div class="sect3">
<h4 id="simple-load-provider-attributes"><a class="link" href="#simple-load-provider-attributes">3.4.5. simple-load-provider Attributes</a></h4>
<div class="paragraph">
<p>The simple load provider always sends the same load factor. Its purpose is testing, experiments and special scenarios such as hot stand-by.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;subsystem xmlns=&quot;urn:jboss:domain:modcluster:1.0&quot;&gt;
  &lt;mod-cluster-config&gt;
    &lt;simple-load-provider factor=&quot;1&quot;/&gt;
  &lt;/mod-cluster-config&gt;
&lt;/subsystem&gt;</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">factor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LoadBalancerFactor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="dynamic-load-provider-attributes"><a class="link" href="#dynamic-load-provider-attributes">3.4.6. dynamic-load-provider Attributes</a></h4>
<div class="paragraph">
<p>The dynamic load provide allows to have <code>load-metric</code> as well as <code>custom-load-metric</code> defined. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;subsystem</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">urn:jboss:domain:modcluster:1.0</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;mod-cluster-config</span> <span class="attribute-name">advertise-socket</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mod_cluster</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;dynamic-load-provider</span> <span class="attribute-name">history</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">decay</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">initial-load</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">50</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
       <span class="tag">&lt;load-metric</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cpu</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">weight</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">capacity</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
       <span class="tag">&lt;load-metric</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sessions</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">weight</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">capacity</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">512</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
       <span class="tag">&lt;custom-load-metric</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mypackage.myclass</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">weight</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">capacity</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">512</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myproperty</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myvalue</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
          <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">otherproperty</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">othervalue</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
       <span class="tag">&lt;/custom-load-metric&gt;</span>
    <span class="tag">&lt;/dynamic-load-provider&gt;</span>
  <span class="tag">&lt;/mod-cluster-config&gt;</span>
<span class="tag">&lt;/subsystem&gt;</span></code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">history</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">history</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">decay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">decayFactor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">512</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialLoad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialLoad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="load-metric-configuration"><a class="link" href="#load-metric-configuration">3.4.7. load-metric Configuration</a></h4>
<div class="paragraph">
<p>The load-metric are the "classes" collecting information to allow computation of the load factor sent to httpd.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Server-Side Load Metric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mandatory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">weight</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">weight</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">capacity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">capacity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">512</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="built-in-load-metric-types"><a class="link" href="#built-in-load-metric-types">3.4.8. Built-in Load Metric Types</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Corresponding Server-Side Load Metric</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cpu</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#average-system-load-metric">AverageSystem</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">heap</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#heap-memory-usage-load-metric">HeapMemoryUsage</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sessions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#active-sessions-load-metric">ActiveSessions</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">requests</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#request-count-load-metric">RequestCount</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">send-traffic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#send-traffic-load-metric">SendTraffic</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive-traffic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#receive-traffic-load-metric">ReceiveTraffic</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">busyness</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#busy-connectors-load-metric">BusyConnectors</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connection-pool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#connection-pool-usage-load-metric">ConnectionPoolUsage</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>mem</code> (<code>SystemMemoryUsage</code>) load metric has been removed since version 1.3, see <a href="https://issues.redhat.com/browse/MODCLUSTER-288">MODCLUSTER-288</a> for more context.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="custom-load-metric-configuration"><a class="link" href="#custom-load-metric-configuration">3.4.9. custom-load-metric Configuration</a></h4>
<div class="paragraph">
<p>The <code>custom-load-metric</code> are for user defined "classes" collecting information.
They are like the <code>load-metric</code> except <code>type</code> is replaced by <code>class</code>:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of your class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mandatory</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See an <a href="https://github.com/Karm/mod_cluster-custom-load-metric">Example Custom Load Metric</a> that reads load from a local file.</p>
</div>
</div>
<div class="sect3">
<h4 id="load-metric-configuration-with-the-jboss-as7-cli"><a class="link" href="#load-metric-configuration-with-the-jboss-as7-cli">3.4.10. load-metric Configuration with the JBoss AS7 CLI</a></h4>
<div class="paragraph">
<p>The <code>load-metric</code> have 4 commands to add and remove metrics</p>
</div>
<div class="ulist">
<ul>
<li>
<p>add-metric: Allows to add a <code>load-metric</code> to the <code>dynamic-load-provider</code>, e.g.</p>
<div class="literalblock">
<div class="content">
<pre>./:add-metric(type=cpu, weight=2, capacity=1)</pre>
</div>
</div>
</li>
<li>
<p>remove-metric: Allows to remove a <code>load-metric</code> from the <code>dynamic-load-provider</code>, e.g.</p>
<div class="literalblock">
<div class="content">
<pre>./:remove-metric(type=cpu)</pre>
</div>
</div>
</li>
<li>
<p>add-custom-metric: Allows to add a <code>load-custom-metric</code> to the <strong>dynamic-load-provider</strong>, e.g.</p>
<div class="literalblock">
<div class="content">
<pre>./:add-custom-metric(class=myclass, weight=2, capacity=1, property=[("pool" =&gt; "mypool"), ("var" =&gt; "myvariable")])</pre>
</div>
</div>
</li>
<li>
<p>remove-custom-metric: Allows to remove a <code>load-custom-metric</code> from the <strong>dynamic-load-provider</strong>, e.g.</p>
<div class="literalblock">
<div class="content">
<pre>./:remove-custom-metric(class=myclass)</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="building-worker-side-components"><a class="link" href="#building-worker-side-components">3.5. Building worker-side Components</a></h3>
<div class="sect3">
<h4 id="requirements-2"><a class="link" href="#requirements-2">3.5.1. Requirements</a></h4>
<div class="paragraph">
<p>Building mod_cluster&#8217;s worker-side components from source requires the following tools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JDK 5.0+</p>
</li>
<li>
<p>Maven 2.0+</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="building"><a class="link" href="#building">3.5.2. Building</a></h4>
<div class="paragraph">
<p>Steps to build:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download the mod_cluster sources</p>
<div class="literalblock">
<div class="content">
<pre>git clone git://github.com/modcluster/mod_cluster.git</pre>
</div>
</div>
</li>
<li>
<p>Use maven "dist" profile to build:</p>
<div class="literalblock">
<div class="content">
<pre>cd mod_cluster
mvn -P dist package</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Some unit tests require UDP port 23365. Make sure your local firewall allows the port.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="built-artifacts"><a class="link" href="#built-artifacts">3.5.3. Built Artifacts</a></h4>
<div class="paragraph">
<p>The build produces the following output in the target directory:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>mod-cluster.sar
Exploded format sar to copy to the deploy dir in your JBoss AS install.</p>
</li>
<li>
<p>JBossWeb-Tomcat/lib directory
Jar files to copy to the lib directory in your JBossWeb or Tomcat install to support use of mod_cluster.</p>
</li>
<li>
<p>demo directory
The load balancing demo application.</p>
</li>
</ul>
</div>
<div class="ulist">
<ul>
<li>
<p>mod-cluster-XXX.tar.gz
The full distribution tarball; includes the aforementioned elements.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="worker-side-configuration-properties"><a class="link" href="#worker-side-configuration-properties">3.5.4. worker-side Configuration Properties</a></h4>
<div class="paragraph">
<p>The tables below enumerate the configuration properties available to an application server node.
The location for these properties depends on how mod_cluster is configured.</p>
</div>
<div class="sect4">
<h5 id="proxy-discovery-configuration-2"><a class="link" href="#proxy-discovery-configuration-2">Proxy Discovery Configuration</a></h5>
<div class="paragraph">
<p>The list of proxies from which an application expects to receive AJP
connections is either defined statically, via the addresses defined in the proxyList
configuration property; or discovered dynamically via the advertise mechanism. Using a special mod_advertise
module, proxies can advertise their existence by periodically broadcasting a multicast message containing their address:port.
This functionality is enabled via the advertise configuration
property. If configured to listen, a server can learn of the proxy&#8217;s existence, then notify that proxy of its
own existence, and update its configuration accordingly. This frees both the proxy <strong>and</strong> the server
from having to define static, environment-specific configuration values.</p>
</div>
</div>
<div class="sect4">
<h5 id="session-draining-strategy"><a class="link" href="#session-draining-strategy">Session draining strategy</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tomcat attribute</th>
<th class="tableblock halign-left valign-top">AS7/WildFly attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sessionDrainingStrategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">session-draining-strategy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DEFAULT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Indicates the session draining strategy used during undeployment of a web application. There are three possible values:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>DEFAULT</code>: Drain sessions before web application undeploy only if the web application is non-distributable.</p>
</li>
<li>
<p><code>ALWAYS</code>: Always drain sessions before web application undeploy, even for distributable web applications.</p>
</li>
<li>
<p><code>NEVER</code>: Do not drain sessions before web application undeploy, even for non-distributable web application.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="proxies"><a class="link" href="#proxies">Proxies</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tomcat attribute</th>
<th class="tableblock halign-left valign-top">AS7 attribute</th>
<th class="tableblock halign-left valign-top">WildFly attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxyList</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy-list</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxies</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>Tomcat/AS7: Defines a comma delimited list of httpd proxies with which this node will initially communicate. Value should be of the form: <strong>address1</strong>:*port1*,<strong>address2</strong>:*port2*. Using the default configuration, this property can by manipulated via the jboss.mod_cluster.proxyList system property.</p>
</li>
<li>
<p>WildFly: In WildFly, the <code>proxy-list</code> attribute of the modcluster subsystem element is deprecated. Instead, one uses an output socket binding. The following example leverages <code>jboss-cli.sh</code>, e.g. :</p>
</li>
<li>
<p>Add a socket binding: <code>/socket-binding-group=standard-sockets/remote-destination-outbound-socket-binding=my-proxies:add(host=10.10.10.11, port=3333)</code></p>
</li>
<li>
<p>Add the socket binding to the modcluster subsystem: <code>/subsystem=modcluster/mod-cluster-config=configuration:write-attribute(name=proxies, value="my-proxies")</code></p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="excluded-contexts"><a class="link" href="#excluded-contexts">Excluded contexts</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tomcat attribute</th>
<th class="tableblock halign-left valign-top">AS7/WildFly attribute</th>
<th class="tableblock halign-left valign-top">WildFly Default</th>
<th class="tableblock halign-left valign-top">Tomcat/AS7 Default</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">excludedContexts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">excluded-contexts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ROOT, admin-console, invoker, bossws, jmx-console, juddi, web-console</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>List of contexts to exclude from httpd registration, of the form: <strong>host1</strong>:*context1*,<strong>host2</strong>:*context2*,<strong>host3</strong>:*context3*
If no host is indicated, it is assumed to be the default host of the server (e.g. localhost). "ROOT" indicates the root context. Using the default configuration, this property can by manipulated via the jboss.mod_cluster.excludedContexts system property.</p>
</div>
</div>
<div class="sect4">
<h5 id="auto-enable-contexts"><a class="link" href="#auto-enable-contexts">Auto Enable Contexts</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tomcat attribute</th>
<th class="tableblock halign-left valign-top">AS7/WildFly attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">autoEnableContexts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">auto-enable-contexts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If false the contexts are registered disabled in httpd, they need to be enabled via the enable() mbean method, jboss-cli command or via mod_cluster-manager web console on Apache HTTP Server.</p>
</div>
</div>
<div class="sect4">
<h5 id="stop-context-timeout"><a class="link" href="#stop-context-timeout">Stop context timeout</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tomcat attribute</th>
<th class="tableblock halign-left valign-top">AS7/WildFly attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stopContextTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stop-context-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The amount of time in seconds for which to wait for a clean shutdown of a context (completion of pending requests for a distributable context; or destruction/expiration of active sessions for a non-distributable context).</p>
</div>
</div>
<div class="sect4">
<h5 id="stop-context-timeout-unit"><a class="link" href="#stop-context-timeout-unit">Stop context timeout unit</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tomcat attribute</th>
<th class="tableblock halign-left valign-top">AS7/WildFly attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stopContextTimeoutUnit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimeUnit.SECONDS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Tomcat allows for configuring an arbitrary TimeUnit for Stop context timeout</p>
</div>
</div>
<div class="sect4">
<h5 id="proxy-url"><a class="link" href="#proxy-url">Proxy URL</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tomcat attribute</th>
<th class="tableblock halign-left valign-top">AS7/WildFly attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxyURL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy-url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Balancer</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If defined, this value will be prepended to the URL of MCMP commands.</p>
</div>
</div>
<div class="sect4">
<h5 id="socket-timeout"><a class="link" href="#socket-timeout">Socket timeout</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tomcat attribute</th>
<th class="tableblock halign-left valign-top">AS7/WildFly attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">socketTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">socket-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20 s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>How long to wait for a response from an httpd proxy to MCMP commands before timing out, and flagging the proxy as in error.</p>
</div>
</div>
<div class="sect4">
<h5 id="advertise"><a class="link" href="#advertise">Advertise</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tomcat/AS7/WildFly attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertise</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true, if proxyList is undefined, false otherwise</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If enabled, httpd proxies will be auto-discovered via receiving multicast announcements.
This can be used either in concert or in place of a static proxies.</p>
</div>
</div>
<div class="sect4">
<h5 id="advertise-socket-group"><a class="link" href="#advertise-socket-group">Advertise socket group</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tomcat attribute</th>
<th class="tableblock halign-left valign-top">AS7/WildFly attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top"></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertiseGroupAddress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertise-socket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">224.0.1.105</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertisePort</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">in advertise-socket</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">23364</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>UDP multicast address:port on which to listen for httpd proxy multicast advertisements. Beware of the actual <strong>interface</strong> your
balancer/worker sends to/receives from. See <a href="https://issues.redhat.com/browse/MODCLUSTER-487">MODCLUSTER-487</a> for Apache HTTP Server behaviour
and <a href="https://issues.redhat.com/browse/MODCLUSTER-495">MODCLUSTER-495</a> for Tomcat&#8217;s caveat.</p>
</div>
</div>
<div class="sect4">
<h5 id="advertise-security-key"><a class="link" href="#advertise-security-key">Advertise security key</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tomcat attribute</th>
<th class="tableblock halign-left valign-top">AS7/WildFly attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Scope</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertiseSecurityKey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertise-security-key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>None</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Balancer</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If specified, httpd proxy advertisements checksums (using this value as a salt) will be required to be verified on the server side. This option <strong>does not</strong> secure your installation, it <strong>does not</strong> replace proper SSL configuration. It merely ensures that only certain workers can talk to certain balancers.
Beware of <a href="https://issues.redhat.com/browse/MODCLUSTER-446">MODCLUSTER-446</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="advertise-thread-factory"><a class="link" href="#advertise-thread-factory">Advertise thread factory</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tomcat attribute</th>
<th class="tableblock halign-left valign-top">AS7/WildFly attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Scope</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">advertiseThreadFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executors.defaultThreadFactory()</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The thread factory used to create the background advertisement listener.</p>
</div>
</div>
<div class="sect4">
<h5 id="jvmroute-factory"><a class="link" href="#jvmroute-factory">JVMRoute factory</a></h5>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Tomcat attribute</th>
<th class="tableblock halign-left valign-top">AS7/WildFly attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Location</th>
<th class="tableblock halign-left valign-top">Scope</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jvmRouteFactory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">new SystemPropertyJvmRouteFactory(new UUIDJvmRouteFactory(), "jboss.mod_cluster.jvmRoute")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Worker</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Defines the strategy for determining the jvm route of a node, if none was specified in Tomcat&#8217;s server.xml.
The default factory first consults the <code>jboss.mod_cluster.jvmRoute</code> system property. If this system property is undefined, the jvm route is assigned a UUID.
WildFly with Undertow web subsystem uses Undertow&#8217;s <code>instance-id</code> or <code>jboss.mod_cluster.jvmRoute</code> system property or a UUID.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="proxy-configuration-2"><a class="link" href="#proxy-configuration-2">3.5.5. Proxy Configuration</a></h4>
<div class="paragraph">
<p>The following configuration values are sent to proxies during server
startup, when a proxy is detected via the advertise mechanism, or during
the resetting of a proxy&#8217;s configuration during error recovery.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">AS7 Attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Scope</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stickySession</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sticky-session</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Balancer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether subsequent requests for a given session should be routed to the same node, if possible.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stickySessionRemove</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sticky-session-remove</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Balancer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether the httpd proxy should remove session stickiness in the event that the balancer is unable to route a request to the node to which it is stuck. This property is ignored if stickySession is false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stickySessionForce</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sticky-session-force</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Balancer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indicates whether the httpd proxy should return an error in the event that the balancer is unable to route a request to the node to which it is stuck. This property is ignored if stickySession is false.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">workerTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">worker-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Balancer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of seconds to wait for a worker to become available to handle a request. When no workers of a balancer are usable, mod_cluster will retry after a while (workerTimeout/100). That is timeout in the balancer mod_proxy documentation. A value of -1 indicates that the httpd will not wait for a worker to be available and will return an error if none is available.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxAttempts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">max-attempts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Balancer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of failover attempts before giving up. The minimum value is 0, i.e. no failover. The default value is 1, i.e. do a one failover attempt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flushPackets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flush-packets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables/disables packet flushing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flushWait</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flush-wait</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time to wait before flushing packets in milliseconds. A value of -1 means wait forever.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time (in seconds) in which to wait for a pong answer to a ping</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">smax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">smax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determined by httpd configuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Soft maximum idle connection count (that is the smax in worker mod_proxy documentation). The maximum value depends on the httpd thread configuration (ThreadsPerChild or 1).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ttl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ttl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time to live (in seconds) for idle connections above smax</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nodeTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">node-timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timeout (in seconds) for proxy connections to a node. That is the time mod_cluster will wait for the back-end response before returning error. That corresponds to timeout in the worker mod_proxy documentation. A value of -1 indicates no timeout. Note that mod_cluster always uses a cping/cpong before forwarding a request and the connectiontimeout value used by mod_cluster is the ping value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">balancer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">balancer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mycluster</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The balancer name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loadBalancingGroup</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain load-balancing-group</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>None</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Node</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If specified, load will be balanced among jvmRoutes withing the same load balancing group. A loadBalancingGroup is conceptually equivalent to a mod_jk domain directive. This is primarily used in conjunction with partitioned session replication (e.g. buddy replication).</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When nodeTimeout is not defined the ProxyTimeout directive Proxy is
used. If ProxyTimeout is not defined the server timeout (Timeout) is
used (default 300 seconds). nodeTimeout, ProxyTimeout or Timeout is set
at the socket level.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="ssl-configuration-2"><a class="link" href="#ssl-configuration-2">SSL Configuration</a></h5>
<div class="paragraph">
<p>The communication channel between application servers and httpd proxies
uses HTTP by default. This channel can be secured using HTTPS by setting
the ssl property to true.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This HTTP/HTTPS channel should not be confused with the processing of HTTP/HTTPS client requests.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">AS7 Attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>None</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Should connection to proxy use a secure socket layer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sslCiphers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cipher-suite</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default JSSE cipher suites</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the cipher suites used to initialize an SSL socket ignoring any unsupported ciphers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sslProtocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TLS (ALL in AS7)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Overrides the default SSL socket protocol.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sslCertificateEncodingAlgorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>None</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default JSSE key manager algorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The algorithm of the key manager factory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sslKeyStore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">certificate-key-file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System.getProperty("user.home") + "/.keystore"</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the key store containing client certificates</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sslKeyStorePassword</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">changeit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password granting access to the key store (and trust store in AS7)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sslKeyStoreType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>None</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JKS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The type of key store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sslKeyStoreProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>None</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default JSSE security provider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The key store provider</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sslTrustAlgorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>None</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default JSSE trust manager algorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The algorithm of the trust manager factory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sslKeyAlias</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">key-alias</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The alias of the key holding the client certificates in the key store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sslCrlFile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ca-revocation-url</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Certificate revocation list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sslTrustMaxCertLength</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>None</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum length of a certificate held in the trust store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sslTrustStore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>None</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.net.ssl.trustStorePassword</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the file containing the trust store</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sslTrustStorePassword</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>None</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.net.ssl.trustStore</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password granting access to the trust store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sslTrustStoreType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>None</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.net.ssl.trustStoreType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The trust store type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sslTrustStoreProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>None</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.net.ssl.trustStoreProvider</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The trust store provider</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="load-configuration-for-jboss-web-and-tomcat"><a class="link" href="#load-configuration-for-jboss-web-and-tomcat">Load Configuration for JBoss Web and Tomcat</a></h5>
<div class="paragraph">
<p>Additional configuration properties used when mod_cluster is configured
in JBoss Web standalone or Tomcat.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute</th>
<th class="tableblock halign-left valign-top">Default</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loadMetricClass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jboss.modcluster.load.metric.impl.BusyConnectorsLoadMetric</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Class name of an object implementing <code>org.jboss.load.metric.LoadMetric</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loadMetricCapacity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The capacity of the load metric defined via the loadMetricClass property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loadHistory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of historic load values to consider in the load balance factor computation.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">loadDecayFactor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The factor by which a historic load values should degrade in significance.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">initialLoad</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial load within the range [0..100] with which to prepopulate historical values. Used to gradually drive load to the node. Value of 0 prepopulates with full load and value of -1 disables this behavior.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="worker-side-load-metrics"><a class="link" href="#worker-side-load-metrics">3.6. Worker-side Load Metrics</a></h3>
<div class="paragraph">
<p>A major feature of mod_cluster is the ability to use server-side load
metrics to determine how best to balance requests.</p>
</div>
<div class="paragraph">
<p>The <code>DynamicLoadBalanceFactorProvider</code> bean computes the load
balance factor of a node from a defined set of load metrics.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DynamicLoadBalanceFactorProvider</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.load.impl.DynamicLoadBalanceFactorProvider</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">On Demand</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;annotation&gt;</span>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name=&quot;jboss.web:service=LoadBalanceFactorProvider&quot;,exposedInterface=org.jboss.modcluster.load.impl.DynamicLoadBalanceFactorProviderMBean.class)<span class="tag">&lt;/annotation&gt;</span>
  <span class="tag">&lt;constructor&gt;</span>
    <span class="tag">&lt;parameter&gt;</span>
      <span class="tag">&lt;set</span> <span class="attribute-name">elementClass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.load.metric.LoadMetric</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;inject</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BusyConnectorsLoadMetric</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;inject</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HeapMemoryUsageLoadMetric</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/set&gt;</span>
    <span class="tag">&lt;/parameter&gt;</span>
  <span class="tag">&lt;/constructor&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">history</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>9<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">decayFactor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>2<span class="tag">&lt;/property&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">initialLoad</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>0<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Load metrics can be configured with an associated weight and capacity.</p>
</div>
<div class="paragraph">
<p>The weight (default is 1) indicates the significance of a metric with
respect to the other metrics. For example, a metric of weight 2 will
have twice the impact on the overall load factor than a metric of weight
1.</p>
</div>
<div class="paragraph">
<p>The capacity of a metric serves 2 functions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To normalize the load values from each metric. In some load metrics,
capacity is already reflected in the load values. The capacity of a
metric should be configured such that <code>0 &lt;= (load / capacity) \&gt;= 1</code>.</p>
</li>
<li>
<p>To favor some nodes over others. By setting the metric capacities to
different values on each node, proxies will effectively favor nodes
with higher capacities, since they will return smaller load values.
This adds an interesting level of granularity to node weighting.
Consider a cluster of two nodes, one with more memory, and a second
with a faster CPU; and two metrics, one memory-based and the other
CPU-based. In the memory-based metric, the first node would be given
a higher load capacity than the second node. In a CPU-based metric,
the second node would be given a higher load capacity than the first
node.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each load metric contributes a value to the overall load factor of a
node. The load factors from each metric are aggregated according to
their weights.</p>
</div>
<div class="paragraph">
<p>In general, the load factor contribution of a given metric is: <code>(load /
capacity) * weight / total weight</code>.</p>
</div>
<div class="paragraph">
<p>The DynamicLoadBalanceFactorProvider applies a time decay function to
the loads returned by each metric. The aggregate load, with respect to
previous load values, can be expressed by the following formula:</p>
</div>
<div class="paragraph">
<p>L = (L<sub>0</sub>/D<sup>0</sup> + L <sub>1</sub>/D<sup>1</sup> + L<sub>2</sub>/D<sup>2</sup> + L<sub>3</sub>/D<sup>3</sup> + ... + L<sub>H</sub>/D<sup>H</sup>) / (1/D<sup>0</sup> + 1/D<sup>1</sup> + 1/D<sup>2</sup> + 1/D<sup>3</sup> + ... 1/D<sup>H</sup>)</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>or more concisely as:</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>L = (∑<sup>H</sup><sub>i=0</sub> L<sub>i</sub>/D<sup>i</sup>) / (∑<sup>H</sup><sub>i=0</sub> 1/D<sup>i</sup>)</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>where D = decayFactor, and H = history.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Setting history = 0 effectively disables the time decay function and
only the current load for each metric will be considered in the load
balance factor computation.</p>
</div>
<div class="paragraph">
<p>The mod_cluster load balancer expects the load factor to be an integer
between 0 and 100, where 0 indicates max load and 100 indicates zero
load. Therefore, the final load factor sent to the load balancer</p>
</div>
<div class="paragraph">
<p>L<sub>Final</sub> = 100 - (L * 100)</p>
</div>
<div class="paragraph">
<p>While you are free to write your own load metrics, the following
LoadMetrics are available out of the box:</p>
</div>
<div class="sect3">
<h4 id="web-container-metrics"><a class="link" href="#web-container-metrics">3.6.1. Web Container metrics</a></h4>
<div class="sect4">
<h5 id="active-sessions-load-metric"><a class="link" href="#active-sessions-load-metric">Active Sessions Load Metric</a></h5>
<div class="ulist">
<ul>
<li>
<p>Requires an explicit capacity</p>
</li>
<li>
<p>Uses <code>SessionLoadMetricSource</code> to query session managers</p>
</li>
<li>
<p>Analogous to method=S in mod_jk</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>e.g., with JBoss AS 5:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ActiveSessionsLoadMetric</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.load.metric.impl.ActiveSessionsLoadMetric</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">On Demand</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;annotation&gt;</span>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name=&quot;jboss.web:service=ActiveSessionsLoadMetric&quot;,exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)<span class="tag">&lt;/annotation&gt;</span>
  <span class="tag">&lt;constructor&gt;</span>
    <span class="tag">&lt;parameter&gt;</span><span class="tag">&lt;inject</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SessionLoadMetricSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/parameter&gt;</span>
  <span class="tag">&lt;/constructor&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">capacity</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>1000<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SessionLoadMetricSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.load.metric.impl.SessionLoadMetricSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">On Demand</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;constructor&gt;</span>
    <span class="tag">&lt;parameter</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.management.MBeanServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;inject</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">JMXKernel</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mbeanServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/parameter&gt;</span>
  <span class="tag">&lt;/constructor&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="busy-connectors-load-metric"><a class="link" href="#busy-connectors-load-metric">Busy Connectors Load Metric</a></h5>
<div class="ulist">
<ul>
<li>
<p>Returns the percentage of connector threads from the thread pool that are busy servicing requests</p>
</li>
<li>
<p>Uses <code>ThreadPoolLoadMetricSource</code> to query connector thread</p>
</li>
<li>
<p>Analogous to <code>method=B</code> in mod_jk</p>
</li>
<li>
<p><a href="https://github.com/modcluster/mod_cluster/blob/main/core/src/main/java/org/jboss/modcluster/load/metric/impl/BusyConnectorsLoadMetric.java">BusyConnectorsLoadMetric.java</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>e.g., with JBoss AS 5:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">BusyConnectorsLoadMetric</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.load.metric.impl.BusyConnectorsLoadMetric</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">On Demand</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;annotation&gt;</span>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name=&quot;jboss.web:service=BusyConnectorsLoadMetric&quot;,exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)<span class="tag">&lt;/annotation&gt;</span>
  <span class="tag">&lt;constructor&gt;</span>
    <span class="tag">&lt;parameter&gt;</span><span class="tag">&lt;inject</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ThreadPoolLoadMetricSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/parameter&gt;</span>
  <span class="tag">&lt;/constructor&gt;</span>
<span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ThreadPoolLoadMetricSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.load.metric.impl.ThreadPoolLoadMetricSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">On Demand</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;constructor&gt;</span>
    <span class="tag">&lt;parameter</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.management.MBeanServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;inject</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">JMXKernel</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mbeanServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/parameter&gt;</span>
  <span class="tag">&lt;/constructor&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="receive-traffic-load-metric"><a class="link" href="#receive-traffic-load-metric">Receive Traffic Load Metric</a></h5>
<div class="ulist">
<ul>
<li>
<p>Returns the incoming request POST traffic in KB/sec (the application needs to read POST data)</p>
</li>
<li>
<p>Requires an explicit capacity</p>
</li>
<li>
<p>Uses <code>RequestProcessorLoadMetricSource</code> to query request processors</p>
</li>
<li>
<p>Analogous to <code>method=T</code> in mod_jk</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>e.g., with JBoss AS 5:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ReceiveTrafficLoadMetric</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.load.metric.impl.ReceiveTrafficLoadMetric</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">On Demand</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;annotation&gt;</span>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name=&quot;jboss.web:service=ReceiveTrafficLoadMetric&quot;,exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)<span class="tag">&lt;/annotation&gt;</span>
  <span class="tag">&lt;constructor&gt;</span>
    <span class="tag">&lt;parameter</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.load.metric.impl.RequestProcessorLoadMetricSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;inject</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RequestProcessorLoadMetricSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/parameter&gt;</span>
  <span class="tag">&lt;/constructor&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">capacity</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>1024<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RequestProcessorLoadMetricSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.load.metric.impl.RequestProcessorLoadMetricSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">On Demand</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;constructor&gt;</span>
    <span class="tag">&lt;parameter</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.management.MBeanServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;inject</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">JMXKernel</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mbeanServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/parameter&gt;</span>
  <span class="tag">&lt;/constructor&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="send-traffic-load-metric"><a class="link" href="#send-traffic-load-metric">Send Traffic Load Metric</a></h5>
<div class="ulist">
<ul>
<li>
<p>Returns the outgoing request traffic in KB/sec</p>
</li>
<li>
<p>Requires an explicit capacity</p>
</li>
<li>
<p>Uses <code>RequestProcessorLoadMetricSource</code> to query request processors</p>
</li>
<li>
<p>Analogous to method=T in mod_jk</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>e.g., with JBoss AS 5:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SendTrafficLoadMetric</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.load.metric.impl.SendTrafficLoadMetric</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">On Demand</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;annotation&gt;</span>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name=&quot;jboss.web:service=SendTrafficLoadMetric&quot;,exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)<span class="tag">&lt;/annotation&gt;</span>
  <span class="tag">&lt;constructor&gt;</span>
    <span class="tag">&lt;parameter</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.load.metric.impl.RequestProcessorLoadMetricSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;inject</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RequestProcessorLoadMetricSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/parameter&gt;</span>
  <span class="tag">&lt;/constructor&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">capacity</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>512<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="request-count-load-metric"><a class="link" href="#request-count-load-metric">Request Count Load Metric</a></h5>
<div class="ulist">
<ul>
<li>
<p>Returns the number of requests/sec</p>
</li>
<li>
<p>Requires an explicit capacity</p>
</li>
<li>
<p>Uses <code>RequestProcessorLoadMetricSource</code> to query request processors</p>
</li>
<li>
<p>Analogous to <code>method=R</code> in mod_jk</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>e.g., with JBoss AS 5:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RequestCountLoadMetric</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.load.metric.impl.RequestCountLoadMetric</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">On Demand</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;annotation&gt;</span>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name=&quot;jboss.web:service=RequestCountLoadMetric&quot;,exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)<span class="tag">&lt;/annotation&gt;</span>
  <span class="tag">&lt;constructor&gt;</span>
    <span class="tag">&lt;parameter</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.load.metric.impl.RequestProcessorLoadMetricSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;inject</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">RequestProcessorLoadMetricSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/parameter&gt;</span>
  <span class="tag">&lt;/constructor&gt;</span>
  <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">capacity</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>1000<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="systemjvm-metrics"><a class="link" href="#systemjvm-metrics">3.6.2. System/JVM metrics</a></h4>
<div class="sect4">
<h5 id="average-system-load-metric"><a class="link" href="#average-system-load-metric">Average System Load Metric</a></h5>
<div class="ulist">
<ul>
<li>
<p>Returns CPU load</p>
</li>
<li>
<p>Requires Java 1.6+</p>
</li>
<li>
<p>Uses <code>OperatingSystemLoadMetricSource</code> to generically read attributes</p>
</li>
<li>
<p>Is not available on Windows</p>
</li>
<li>
<p><a href="https://github.com/modcluster/mod_cluster/blob/main/core/src/main/java/org/jboss/modcluster/load/metric/impl/AverageSystemLoadMetric.java">AverageSystemLoadMetric.java</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>e.g., with JBoss AS 5:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">AverageSystemLoadMetric</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.load.metric.impl.AverageSystemLoadMetric</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">On Demand</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;annotation&gt;</span>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name=&quot;jboss.web:service=AverageSystemLoadMetric&quot;,exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)<span class="tag">&lt;/annotation&gt;</span>
  <span class="tag">&lt;constructor&gt;</span>
    <span class="tag">&lt;parameter&gt;</span><span class="tag">&lt;inject</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OperatingSystemLoadMetricSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/parameter&gt;</span>
  <span class="tag">&lt;/constructor&gt;</span>
<span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">OperatingSystemLoadMetricSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.load.metric.impl.OperatingSystemLoadMetricSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">On Demand</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="heap-memory-usage-load-metric"><a class="link" href="#heap-memory-usage-load-metric">Heap Memory Usage Load Metric</a></h5>
<div class="ulist">
<ul>
<li>
<p>Returns the heap memory usage as a percentage of max heap size</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>e.g., with JBoss AS 5:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HeapMemoryUsageLoadMetric</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.load.metric.impl.HeapMemoryUsageLoadMetric</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">On Demand</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;annotation&gt;</span>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name=&quot;jboss.web:service=HeapMemoryUsageLoadMetric&quot;,exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)<span class="tag">&lt;/annotation&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="other-metrics"><a class="link" href="#other-metrics">3.6.3. Other metrics</a></h4>
<div class="sect4">
<h5 id="connection-pool-usage-load-metric"><a class="link" href="#connection-pool-usage-load-metric">ConnectionPoolUsageLoadMetric</a></h5>
<div class="ulist">
<ul>
<li>
<p>Returns the percentage of connections from a connection pool that are in use</p>
</li>
<li>
<p>Uses ConnectionPoolLoadMetricSource to query JCA connection pools</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>e.g., with JBoss AS 5:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ConnectionPoolUsageMetric</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.load.metric.impl.ConnectionPoolUsageLoadMetric</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">On Demand</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;annotation&gt;</span>@org.jboss.aop.microcontainer.aspects.jmx.JMX(name=&quot;jboss.web:service=ConnectionPoolUsageLoadMetric&quot;,exposedInterface=org.jboss.modcluster.load.metric.LoadMetricMBean.class)<span class="tag">&lt;/annotation&gt;</span>
  <span class="tag">&lt;constructor&gt;</span>
    <span class="tag">&lt;parameter&gt;</span><span class="tag">&lt;inject</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ConnectionPoolLoadMetricSource</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span><span class="tag">&lt;/parameter&gt;</span>
  <span class="tag">&lt;/constructor&gt;</span>
<span class="tag">&lt;/bean&gt;</span>
<span class="tag">&lt;bean</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ConnectionPoolLoadMetricSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.load.metric.impl.ConnectionPoolLoadMetricSource</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">mode</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">On Demand</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;constructor&gt;</span>
    <span class="tag">&lt;parameter</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">javax.management.MBeanServer</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;inject</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">JMXKernel</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">property</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">mbeanServer</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/parameter&gt;</span>
  <span class="tag">&lt;/constructor&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="installing-worker-side-components"><a class="link" href="#installing-worker-side-components">3.7. Installing Worker-side Components</a></h3>
<div class="paragraph">
<p>First, extract the server-side binary to a temporary directory. The
following assumes it was extracted to /tmp/mod_cluster</p>
</div>
<div class="paragraph">
<p>Your next step depends on whether your target server is JBoss AS or
JBossWeb/Tomcat.</p>
</div>
<div class="sect3">
<h4 id="installing-in-jboss-as-6-0-0-m1-and-up"><a class="link" href="#installing-in-jboss-as-6-0-0-m1-and-up">3.7.1. Installing in JBoss AS 6.0.0.M1 and up</a></h4>
<div class="paragraph">
<p>You don&#8217;t need to do anything to install the java-side binaries in AS
6.x; it&#8217;s part of the AS distribution&#8217;s default, standard and all
configurations.</p>
</div>
</div>
<div class="sect3">
<h4 id="installing-in-jboss-as-5-x"><a class="link" href="#installing-in-jboss-as-5-x">3.7.2. Installing in JBoss AS 5.x</a></h4>
<div class="paragraph">
<p>Assuming \$JBOSS_HOME indicates the root of your JBoss AS install and
that you want to use mod_cluster in the AS&#8217;s all config:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cp -r /tmp/mod_cluster/mod_cluster.sar $JBOSS_HOME/server/all/deploy</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="installing-in-tomcat-2"><a class="link" href="#installing-in-tomcat-2">3.7.3. Installing in Tomcat</a></h4>
<div class="paragraph">
<p>Assuming <code>$CATALINA_HOME</code> indicates the root of your Tomcat install:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cp /tmp/mod_cluster/JBossWeb-Tomcat/lib/jboss-logging.jar $CATALINA_HOME/lib/
cp /tmp/mod_cluster/JBossWeb-Tomcat/lib/mod_cluster-container-catalina* $CATALINA_HOME/lib/
cp /tmp/mod_cluster/JBossWeb-Tomcat/lib/mod_cluster-container-spi* $CATALINA_HOME/lib/
cp /tmp/mod_cluster/JBossWeb-Tomcat/lib/mod_cluster-core* $CATALINA_HOME/lib/</code></pre>
</div>
</div>
<div class="paragraph">
<p>and additionally for Tomcat6:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cp /tmp/mod_cluster/JBossWeb-Tomcat/lib/mod_cluster-container-tomcat6* $CATALINA_HOME/lib</code></pre>
</div>
</div>
<div class="paragraph">
<p>and additionally for Tomcat7:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cp /tmp/mod_cluster/JBossWeb-Tomcat/lib/mod_cluster-container-tomcat7* $CATALINA_HOME/lib</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="httpd"><a class="link" href="#httpd">4. httpd configuration</a></h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="https://github.com/modcluster/docs.modcluster.io/edit/main/docs/src/main/asciidoc/native.adoc">Improve this page – edit on GitHub.</a>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="apache-httpd-configuration"><a class="link" href="#apache-httpd-configuration">4.1. Apache httpd configuration</a></h3>
<div class="paragraph">
<p>You need to load the modules that are needed for mod_proxy_cluster for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule proxy_ajp_module modules/mod_proxy_ajp.so
LoadModule slotmem_shm_module modules/mod_slotmem_shm.so
LoadModule manager_module modules/mod_manager.so
LoadModule proxy_cluster_module modules/mod_proxy_cluster.so
LoadModule advertise_module modules/mod_advertise.so</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>mod_cluster 1.3.x</strong> Note that mod_cluster 1.3.x has its own implementation of
a slotmem module. You have to change the appropriate line to
<code>LoadModule cluster_slotmem_module modules/mod_cluster_slotmem.so</code> to use it instead
of httpd&#8217;s implementation version 2.x uses.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>mod_proxy and mod_proxy_ajp are standard httpd modules. mod_cluster_slotmem is a shared slotmem
memory provider. mod_manager is the module that reads information from JBoss AS/JBossWeb/Tomcat
and updates the shared memory information. mod_proxy_cluster is the module that contains the
balancer for mod_proxy. mod_advertise is an additional module that allows httpd to advertise via
multicast packets the IP and port where the mod_proxy_cluster is listening. This multi-module
architecture allows the modules to easily be changed depending on what the customer wants to do.</p>
</div>
<div class="paragraph">
<p>For example when using http instead of AJP, only remove the following line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>LoadModule proxy_ajp_module modules/mod_proxy_ajp.so</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, if you want to use AJP only, remove the corresponding http line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>LoadModule proxy_http_module modules/mod_proxy_http.so</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mod_proxy-configuration"><a class="link" href="#mod_proxy-configuration">4.2. mod_proxy configuration</a></h3>
<div class="paragraph">
<p>mod_proxy directives like ProxyIOBufferSize could be used to configure mod_proxy_cluster. There is no need to use ProxyPass
directives because mod_proxy_cluster automatically configures which URLs have to be forwarded to JBossWEB.</p>
</div>
</div>
<div class="sect2">
<h3 id="mod_slotmemmod_cluster_slotmem-configuration"><a class="link" href="#mod_slotmemmod_cluster_slotmem-configuration">4.3. mod_slotmem/mod_cluster_slotmem configuration</a></h3>
<div class="paragraph">
<p>The current version does not require any configuration directives. Make sure you are using the correct module
according to your mod_proxy_cluster&#8217;s version.</p>
</div>
</div>
<div class="sect2">
<h3 id="mod_proxy_cluster"><a class="link" href="#mod_proxy_cluster">4.4. mod_proxy_cluster</a></h3>
<div class="sect3">
<h4 id="createbalancers"><a class="link" href="#createbalancers">4.4.1. CreateBalancers</a></h4>
<div class="paragraph">
<p>CreateBalancers define how balancers are created in the httpd VirtualHosts. This is to allow directives like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>ProxyPass / balancer://mycluster1/</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>0 – Create in all VirtualHosts defined in httpd.</p>
</li>
<li>
<p>1 – Don&#8217;t create balancers (requires at least one ProxyPass/ProxyPassMatch to define the balancer names).</p>
</li>
<li>
<p>2 – Create only the main server.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Default:</strong> 2</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>CreateBalancers 1:</strong> When using 1 don&#8217;t forget to configure the balancer in the ProxyPass directive, because the default is
empty stickysession and <code>nofailover=Off</code> and the values received via the MCMP CONFIG message are ignored.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>Default: 2</strong> If you have no <code>ProxyPass</code> directive in the <code>VirtualHost</code>, the <code>VirtualHost</code> is ignored
by mod_proxy_cluster. So, even if <code>CreateBalancers</code> is set to <code>2</code> (default), the main server is used instead
in such configuration.
See also <a href="https://issues.redhat.com/browse/MODCLUSTER-430">MODCLUSTER-430 – CreateBalancers behave the same with option 0 or 2</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="usealias"><a class="link" href="#usealias">4.4.2. UseAlias</a></h4>
<div class="paragraph">
<p>Check that the Alias corresponds to the ServerName (See <a href="http://labs.jboss.com/file-access/default/members/jbossweb/freezone/docs/latest/config/host.html">Host Name Aliases</a>).</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Off – Don&#8217;t check (ignore Aliases)</p>
</li>
<li>
<p>On – Check aliases</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Default:</strong> Off Ignore the Alias information from the nodes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>Older mod_cluster versions:</strong> Versions older than 1.3.1.Final only accept values 0 and 1 respectively.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
UseAlias should be used with <code>ProxyPreserveHost On</code> to work properly.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="lbstatusrecaltime"><a class="link" href="#lbstatusrecaltime">4.4.3. LBstatusRecalTime</a></h4>
<div class="paragraph">
<p>Time interval in seconds for load balancing logic to recalculate the status of a node.</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> 5 seconds</p>
</div>
<div class="paragraph">
<p>The actual formula to recalculate the status of a node is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>status = lbstatus + (elected - oldelected) * 1000) / lbfactor;</code></pre>
</div>
</div>
<div class="paragraph">
<p>lbfactor is received for the node via STATUS messages.lbstatus is recalculated every LBstatusRecalTime seconds using the formula:
<code>lbstatus = (elected - oldelected) * 1000) / lbfactor</code></p>
</div>
<div class="paragraph">
<p>where <code>elected</code> is the amount of time the worker has been elected. <code>oldelected</code> is <code>elected</code> from the last time the <code>lbstatus</code>
was recalculated. The node with the lowest <code>status</code> is selected. Nodes with <code>lbfactor ≤ 0</code> are skipped by the both calculation logics.</p>
</div>
</div>
<div class="sect3">
<h4 id="waitbeforeremove"><a class="link" href="#waitbeforeremove">4.4.4. WaitBeforeRemove</a></h4>
<div class="paragraph">
<p>Time in seconds before a removed node is forgotten by httpd.</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> 10 seconds</p>
</div>
</div>
<div class="sect3">
<h4 id="proxypassmatchproxypass"><a class="link" href="#proxypassmatchproxypass">4.4.5. ProxyPassMatch/ProxyPass</a></h4>
<div class="paragraph">
<p>ProxyPassMatch and ProxyPass are mod_proxy directives that when using <code>!</code> (instead the back-end url) prevent to
reverse-proxy in the path. This could be used allow httpd to serve static information like images.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>ProxyPassMatch ^(/.*\.gif)$ !</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above for example will allow httpd to serve the .gif files directly.</p>
</div>
</div>
<div class="sect3">
<h4 id="enableoptions"><a class="link" href="#enableoptions">4.4.6. EnableOptions</a></h4>
<div class="paragraph">
<p>Use <code>OPTIONS</code> method to periodically check the active connection. Fulfils the same role as the <code>CPING/CPONG</code> used by AJP
but for HTTP/HTTPS connections. The endpoint needs to implement HTTP/1.0.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>On (or no value) – Use OPTIONS</p>
</li>
<li>
<p>Off – Don&#8217;t use OPTIONS</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Default:</strong> On</p>
</div>
</div>
<div class="sect3">
<h4 id="ajpsecret"><a class="link" href="#ajpsecret">4.4.7. AJPSecret</a></h4>
<div class="paragraph">
<p>Use <code>AJPSecret your_secret</code> to provide the secret for the AJP back-end. See mod_proxy_ajp and mod_proxy docs for more
information. If <code>your_secret</code> doesn&#8217;t correspond to the value configured in the back-end the back-end will return 503
to any request coming through the proxy.</p>
</div>
</div>
<div class="sect3">
<h4 id="enablewstunnel"><a class="link" href="#enablewstunnel">4.4.8. EnableWsTunnel</a></h4>
<div class="paragraph">
<p>Use ws or wss instead of http or https when creating nodes (allows WebSocket proxying).</p>
</div>
</div>
<div class="sect3">
<h4 id="wsupgradeheader"><a class="link" href="#wsupgradeheader">4.4.9. WSUpgradeHeader</a></h4>
<div class="paragraph">
<p>Use <code>WSUpgradeHeader value</code> to define the value of the upgrade header that is accepted (corresponds to
<code>ProxyPass upgrade=value</code>). Accepted values are following:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">2.0 (in development)</th>
<th class="tableblock halign-left valign-top">1.3</th>
<th class="tableblock halign-left valign-top">mod_proxy_wstunnel (used in the past)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">protocol name to check before using the WS tunnel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>*</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ANY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read the header value from request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NONE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bypass the header check</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See <code>mod_proxy_http</code> documentation for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="responsefieldsize"><a class="link" href="#responsefieldsize">4.4.10. ResponseFieldSize</a></h4>
<div class="paragraph">
<p>Size in bytes of the HTTP/1.1 buffers of the workers, that limits the header size a webapp
can use (Note: In Tomcat there is  maxHttpHeaderSize that also limits it in the Connector).</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> 8192</p>
</div>
</div>
<div class="sect3">
<h4 id="cachesharefor"><a class="link" href="#cachesharefor">4.4.11. CacheShareFor</a></h4>
<div class="paragraph">
<p>Time to cache the shared memory information in seconds.</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> 0 (no-caching)</p>
</div>
</div>
<div class="sect3">
<h4 id="modproxyclusterhctemplate"><a class="link" href="#modproxyclusterhctemplate">4.4.12. ModProxyClusterHCTemplate</a></h4>
<div class="paragraph">
<p>Set of health check parameters to use with mod_proxy_cluster workers.</p>
</div>
</div>
<div class="sect3">
<h4 id="usenocanon"><a class="link" href="#usenocanon">4.4.13. UseNocanon</a></h4>
<div class="paragraph">
<p>When no ProxyPass or ProxyMatch match the URL, pass the raw URL path to the backend.</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> Off</p>
</div>
</div>
<div class="sect3">
<h4 id="responsestatuscodeonnocontext"><a class="link" href="#responsestatuscodeonnocontext">4.4.14. ResponseStatusCodeOnNoContext</a></h4>
<div class="paragraph">
<p>Response code returned when <code>ProxyPass</code> or <code>ProxyMatch</code> doesn&#8217;t have any matching context.
If the configured value is not a standard HTTP response status code, the server will return <code>500</code> instead
(see <a href="https://issues.redhat.com/browse/MODCLUSTER-801">MODCLUSTER-801</a>). (Since 1.3.20.Final)</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> 404</p>
</div>
</div>
<div class="sect3">
<h4 id="modproxyclusterthreadcount"><a class="link" href="#modproxyclusterthreadcount">4.4.15. ModProxyClusterThreadCount</a></h4>
<div class="paragraph">
<p>Number of threads that should be created for watchdog logic. Must be positive. (Since 2.0)</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> 16</p>
</div>
</div>
<div class="sect3">
<h4 id="deterministicfailover"><a class="link" href="#deterministicfailover">4.4.16. DeterministicFailover</a></h4>
<div class="paragraph">
<p>Controls whether a node upon failover is chosen deterministically.</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> Off</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mod_manager"><a class="link" href="#mod_manager">4.5. mod_manager</a></h3>
<div class="paragraph">
<p>The Context of a mod_manger directive is VirtualHost except mentioned otherwise. <strong>server config</strong> means that it must be outside a
VirtualHost configuration. If not an error message will be displayed and httpd will not start.</p>
</div>
<div class="sect3">
<h4 id="enablemcmpreceive"><a class="link" href="#enablemcmpreceive">4.5.1. EnableMCMPReceive</a></h4>
<div class="paragraph">
<p>EnableMCMPReceive – allow the VirtualHost to receive Mod-Cluster Management Protocol (MCMP) messages. You need one
EnableMCMPReceive in your httpd configuration to allow mod_proxy_cluster to work, put it in the VirtualHost where you
configure advertise.</p>
</div>
<div class="paragraph">
<p>This directive was added to address the issue of receiving MCMP on arbitrary VirtualHosts which was problematic
due to accepting messages on insecure, unintended VirtualHosts.</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> disabled (presence of the directive enables this functionality)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This directive deprecates the original <code>EnableMCPMReceive</code> option as it contains a typo.
      The directive with the correct spelling is available in version 1.3.21.Final and newer.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="memmanagerfile"><a class="link" href="#memmanagerfile">4.5.2. MemManagerFile</a></h4>
<div class="paragraph">
<p>That is the base name for the names mod_manager will use to store configuration, generate keys for shared memory or lock
files. The value may be an absolute path name or a relative one (then it will be relative to the server root);
the directories will be created if needed. It is highly recommended that those files are placed on a local drive and not
an NFS share. (Context: <strong>server config</strong>)</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> <code>$server_root/logs/</code></p>
</div>
<script src="https://gist-it.appspot.com/github/modcluster/mod_proxy_cluster/blob/main/native/mod_manager/mod_manager.c?slice=521:538&footer=minimal"></script>
</div>
<div class="sect3">
<h4 id="maxcontext"><a class="link" href="#maxcontext">4.5.3. Maxcontext</a></h4>
<div class="paragraph">
<p>The maximum number of application contexts supported by mod_proxy_cluster. (Context: <strong>server config</strong>)</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> 100 (If Maxhost is bigger than Maxcontext, then Maxcontext is increased to Maxhost.)</p>
</div>
<script src="https://gist-it.appspot.com/github/modcluster/mod_proxy_cluster/blob/main/native/mod_manager/mod_manager.c?slice=55:56&footer=minimal"></script>
</div>
<div class="sect3">
<h4 id="maxnode"><a class="link" href="#maxnode">4.5.4. Maxnode</a></h4>
<div class="paragraph">
<p>That is the maximum number of nodes supported by mod_proxy_cluster. (Context: <strong>server config</strong>)</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> 20</p>
</div>
<script src="https://gist-it.appspot.com/github/modcluster/mod_proxy_cluster/blob/main/native/mod_manager/mod_manager.c?slice=56:57&footer=minimal"></script>
</div>
<div class="sect3">
<h4 id="maxhost"><a class="link" href="#maxhost">4.5.5. Maxhost</a></h4>
<div class="paragraph">
<p>That is the maximum number of hosts (Aliases) supported by mod_proxy_cluster. That is also the max number of balancers.
(Context: <strong>server config</strong>)</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> 20 (If Maxnode is bigger than Maxhost, then Maxhost is increased to Maxnode.)</p>
</div>
<script src="https://gist-it.appspot.com/github/modcluster/mod_proxy_cluster/blob/main/native/mod_manager/mod_manager.c?slice=57:58&footer=minimal"></script>
</div>
<div class="sect3">
<h4 id="maxsessionid"><a class="link" href="#maxsessionid">4.5.6. Maxsessionid</a></h4>
<div class="paragraph">
<p>Maxsessionid: That is the number of active sessionid we store to give
number of active sessions in the mod_cluster-manager handler. A session
is inactive when mod_cluster doesn&#8217;t receive any information from the
session in 5 minutes. (Context: server config)</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> 0 (the logic is not activated).</p>
</div>
</div>
<div class="sect3">
<h4 id="maxmcmpmaxmesssize"><a class="link" href="#maxmcmpmaxmesssize">4.5.7. MaxMCMPMaxMessSize</a></h4>
<div class="paragraph">
<p>MaxMCMPMaxMessSize: Maximum size of MCMP messages. from other Max
directives.</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> calculated from other Max directives. Min: 1024</p>
</div>
</div>
<div class="sect3">
<h4 id="managerbalancername"><a class="link" href="#managerbalancername">4.5.8. ManagerBalancerName</a></h4>
<div class="paragraph">
<p>ManagerBalancerName: That is the name of balancer to use when the JBoss
AS/JBossWeb/Tomcat doesn&#8217;t provide a balancer name.</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> mycluster</p>
</div>
</div>
<div class="sect3">
<h4 id="persistslots"><a class="link" href="#persistslots">4.5.9. PersistSlots</a></h4>
<div class="paragraph">
<p>PersistSlots: Tell mod_cluster_slotmem to persist the nodes, Alias and Context
in files. (Context: server config)</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> Off</p>
</div>
</div>
<div class="sect3">
<h4 id="checknonce"><a class="link" href="#checknonce">4.5.10. CheckNonce</a></h4>
<div class="paragraph">
<p>CheckNonce: Switch check of nonce when using mod_cluster-manager
handler on | off</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> on (Nonce checked)</p>
</div>
</div>
<div class="sect3">
<h4 id="allowdisplay"><a class="link" href="#allowdisplay">4.5.11. AllowDisplay</a></h4>
<div class="paragraph">
<p>AllowDisplay: Switch additional display on mod_cluster-manager main
page on | off</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> off (Only version displayed)</p>
</div>
</div>
<div class="sect3">
<h4 id="allowcmd"><a class="link" href="#allowcmd">4.5.12. AllowCmd</a></h4>
<div class="paragraph">
<p>AllowCmd: Allow commands using mod_cluster-manager URL on | off</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> on (Commands allowed)</p>
</div>
</div>
<div class="sect3">
<h4 id="reducedisplay"><a class="link" href="#reducedisplay">4.5.13. ReduceDisplay</a></h4>
<div class="paragraph">
<p>ReduceDisplay - Reduce the information the main mod_cluster-manager
page to allow more nodes in the page. on | off</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> off (Full information displayed)</p>
</div>
</div>
<div class="sect3">
<h4 id="sethandler-mod_cluster-manager"><a class="link" href="#sethandler-mod_cluster-manager">4.5.14. SetHandler mod_cluster-manager</a></h4>
<div class="paragraph">
<p>SetHandler mod_cluster-manager: That is the handler to display the node
mod_proxy_cluster sees from the cluster. It displays the information about
the nodes like INFO and additionally counts the number of active
sessions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;Location /mod_cluster-manager&gt;
   SetHandler mod_cluster-manager
   Require ip 127.0.0
&lt;/Location&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>When accessing the location you define in httpd.conf you get something
like:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/native-mod-cluster-manager.jpg" alt="native mod cluster manager">
</div>
</div>
<div class="paragraph">
<p>Note that:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Transferred</strong>: Corresponds to the POST data send to the back-end server.</p>
</li>
<li>
<p><strong>Connected</strong>: Corresponds to the number of requests been processed when the
mod_proxy_cluster status page was requested.</p>
</li>
<li>
<p><strong>sessions</strong>: Corresponds to the number of sessions mod_proxy_cluster report as
active (on which there was a request during the past 5 minutes). That
field is not present when Maxsessionid is zero.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="mod_advertise"><a class="link" href="#mod_advertise">4.5.15. mod_advertise</a></h4>
<div class="paragraph">
<p>mod_advertise uses multicast packets to advertise the VirtualHost where it is
configured that must be the same VirtualHost where mod_manager is defined. Of
course at least one mod_advertise must be in the VirtualHost to allow
mod_proxy_cluster to find the right IP and port to give to the ClusterListener.</p>
</div>
</div>
<div class="sect3">
<h4 id="serveradvertise"><a class="link" href="#serveradvertise">4.5.16. ServerAdvertise</a></h4>
<div class="ulist">
<ul>
<li>
<p>ServerAdvertise On – Use the advertise mechanism to tell the JBoss
AS/JBossWeb/Tomcat to whom it should send the cluster information.</p>
</li>
<li>
<p>ServerAdvertise On <a href="http://hostname:port" class="bare">http://hostname:port</a> – Tell the hostname and port to use.
Only needed if the VirtualHost is not defined correctly, if the VirtualHost is
a <a href="http://httpd.apache.org/docs/2.4/vhosts/name-based.html">Name-based Virtual Host</a>
or when VirtualHost is not used.</p>
</li>
<li>
<p>ServerAdvertise Off – Don&#8217;t use the advertise mechanism.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Default:</strong> Off. (Any Advertise directive in a VirtualHost sets it to On in
the VirtualHost)</p>
</div>
</div>
<div class="sect3">
<h4 id="advertisegroup"><a class="link" href="#advertisegroup">4.5.17. AdvertiseGroup</a></h4>
<div class="paragraph">
<p>AdvertiseGroup IP:port: That is the multicast address to use (something like 232.0.0.2:8888 for example).
IP should correspond to AdvertiseGroupAddress and port to AdvertisePort in the JBoss AS/JBossWeb/Tomcat configuration.
Note that if JBoss AS is used and the -u startup switch is included in the AS startup command, the default AdvertiseGroupAddress
is the value passed via the -u. If port is missing the default port will be used: 23364.</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> 224.0.1.105:23364.</p>
</div>
</div>
<div class="sect3">
<h4 id="advertisefrequency"><a class="link" href="#advertisefrequency">4.5.18. AdvertiseFrequency</a></h4>
<div class="paragraph">
<p>AdvertiseFrequency seconds[.miliseconds]: Time between the multicast
messages advertising the IP and port.</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> 10</p>
</div>
</div>
<div class="sect3">
<h4 id="advertisesecuritykey"><a class="link" href="#advertisesecuritykey">4.5.19. AdvertiseSecurityKey</a></h4>
<div class="paragraph">
<p>AdvertiseSecurityKey value: key string used to verify advertisements checksums. If configured on either side the verification
is required. Both sides must use the same security key.</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> No default value.</p>
</div>
</div>
<div class="sect3">
<h4 id="advertisemanagerurl"><a class="link" href="#advertisemanagerurl">4.5.20. AdvertiseManagerUrl</a></h4>
<div class="paragraph">
<p>AdvertiseManagerUrl value: Not used in this version (It is sent in the X-Manager-Url: value header). That is the URL that
JBoss AS/JBossWeb/Tomcat should use to send information to mod_cluster</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> No default value. Information not sent.</p>
</div>
</div>
<div class="sect3">
<h4 id="advertisebindaddress"><a class="link" href="#advertisebindaddress">4.5.21. AdvertiseBindAddress</a></h4>
<div class="paragraph">
<p>AdvertiseBindAddress IP:port: That is the address and port httpd is bind to send the multicast messages.
This allow to specify an address on multi IP address boxes.</p>
</div>
<div class="paragraph">
<p><strong>Default:</strong> 0.0.0.0:23364</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="minimal-example"><a class="link" href="#minimal-example">4.6. Minimal Example</a></h3>
<div class="paragraph">
<p>Beware of the different names of <code>mod_cluster_slotmem.so</code> and <code>mod_slotmem.so</code> between mod_cluster 1.3.x and older versions.
The 2.x version uses Apache HTTP Server&#8217;s <code>mod_slotmem_shm.so</code>.</p>
</div>
<div class="sect3">
<h4 id="mod_proxy_cluster-2-x-with-apache-http-server-2-4-x"><a class="link" href="#mod_proxy_cluster-2-x-with-apache-http-server-2-4-x">4.6.1. mod_proxy_cluster 2.x with Apache HTTP Server 2.4.x</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>LoadModule proxy_module       modules/mod_proxy.so
LoadModule proxy_http_module  modules/mod_proxy_http.so
LoadModule proxy_ajp_module   modules/mod_proxy_ajp.so
LoadModule slotmem_shm_module modules/mod_slotmem_shm.so

LoadModule manager_module       modules/mod_manager.so
LoadModule proxy_cluster_module modules/mod_proxy_cluster.so
LoadModule advertise_module     modules/mod_advertise.so
LoadModule watchdog_module      modules/mod_watchdog.so

&lt;IfModule manager_module&gt;
  Listen 6666
  ServerName localhost
  &lt;VirtualHost *:6666&gt;

  # Where your worker nodes connect from
  &lt;Location /&gt;
     Require ip 127.0.0
  &lt;/Location&gt;

  ServerAdvertise On
  EnableMCMPReceive

  # Where administrator reads the console from
  &lt;Location /mod_cluster-manager&gt;
     SetHandler mod_cluster-manager
     Require ip 127.0.0
  &lt;/Location&gt;

  &lt;/VirtualHost&gt;
&lt;/IfModule&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>For mod_proxy_cluster 1.3.x you have to change the slotmem module to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>LoadModule cluster_slotmem_module modules/mod_cluster_slotmem.so</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="building-httpd-modules"><a class="link" href="#building-httpd-modules">4.7. Building httpd modules</a></h3>
<div class="paragraph">
<p>mod_cluster 1.3.x and older, both httpd modules and Tomcat/WildFly java libraries reside in the
<a href="https://github.com/modcluster/mod_cluster">mod_cluster</a> repository, see appropriate branches. New
development of mod_cluster httpd modules takes place under a new name mod_proxy_cluster in the
new repository <a href="https://github.com/modcluster/mod_proxy_cluster">mod_proxy_cluster</a>.</p>
</div>
<div class="paragraph">
<p>See <a href="https://asciinema.org/a/7563u1eu6o5jlg3a0gk4wv69f?t=52">ASCII recorded tutorial</a> on httpd modules
compilation with your own system&#8217;s httpd.</p>
</div>
<div class="sect3">
<h4 id="build-from-sources-on-windows"><a class="link" href="#build-from-sources-on-windows">4.7.1. Build from sources on Windows</a></h4>
<div class="paragraph">
<p>We assume you already have a functional Apache HTTP Server on Windows. This example works with
Apache Lounge HTTP Server.
We also assume the system has MS Visual Studio (Community Edition is ample) and CMake installed.
The example operates in cmder shell, but it is not mandatory. A simple Windows cmd prompt would work too.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Download the <a href="https://www.apachelounge.com/download/">Apache Lounge distribution</a>. Our example uses
<a href="https://www.apachelounge.com/download/VS17/binaries/httpd-2.4.58-win64-VS17.zip">httpd-2.4.58-win64-VS17.zip</a>.</p>
</li>
<li>
<p>unzipped:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>C:\Users\%username%
ls
httpd-2.4.58-win64-VS17/ httpd-2.4.58-win64-VS17.zip</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Clone mod_proxy_cluster sources git:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>git clone https://github.com/modcluster/mod_proxy_cluster.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>or download <a href="https://github.com/modcluster/mod_proxy_cluster/archive/main.zip">zipped main branch directly</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Proceed with env vars set and CMake build directory preparation:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>C:\Users\%username%\mod_proxy_cluster\native (main)
mkdir build

C:\Users\%username%\mod_proxy_cluster\native (main)
cd build\

C:\Users\%username%\mod_proxy_cluster\native\build (main)
vcvars64.bat</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here comes the only slightly tricky part: Apache Lounge httpd ships all necessary *.lib files with exported symbols but
for mod_proxy. Since mod_proxy is our dependency, we have to generate these exported symbols from mod_proxy dll.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>dumpbin /exports C:\Users\%username%\Apache24\modules\mod_proxy.so&gt; C:\Users\%username%\Apache24\modules\mod_proxy.exports

echo LIBRARY mod_proxy.so&gt; C:\Users\%username%\Apache24\modules\mod_proxy.def

echo EXPORTS&gt;&gt; C:\Users\%username%\Apache24\modules\mod_proxy.def

for /f &quot;skip=19 tokens=4&quot; %A in (C:\Users\%username%\Apache24\modules\mod_proxy.exports) do echo %A &gt;&gt; C:\Users\%username%\Apache24\modules\mod_proxy.def

lib /def:C:\Users\%username%\Apache24\modules\mod_proxy.def /OUT:C:\Users\%username%\Apache24\modules\mod_proxy.lib /MACHINE:X64 /NAME:mod_proxy.so</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s run CMake:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>C:\Users\%username%\mod_proxy_cluster\native\build (main)
cmake ../ -G &quot;NMake Makefiles&quot; -DCMAKE_BUILD_TYPE=Release -DAPR_LIBRARY=C:\Users\%username%\Apache24\lib\libapr-1.lib -DAPR_INCLUDE_DIR=C:\Users\%username%\Apache24\include\ -DAPACHE_INCLUDE_DIR=C:\Users\%username%\Apache24\include\ -DAPRUTIL_LIBRARY=C:\Users\%username%\Apache24\lib\libaprutil-1.lib -DAPRUTIL_INCLUDE_DIR=C:\Users\%username%\Apache24\include\ -DAPACHE_LIBRARY=C:\Users\%username%\Apache24\lib\libhttpd.lib -DPROXY_LIBRARY=C:\Users\%username%\Apache24\modules\mod_proxy.lib
-- Found APR: C:/Users/karm/Apache24/lib/libapr-1.lib
-- Found APRUTIL: C:/Users/karm/Apache24/lib/libaprutil-1.lib
-- Found APACHE: C:/Users/karm/Apache24/include
-- Build files have been written to: C:/Users/karm/mod_proxy_cluster/native/build</code></pre>
</div>
</div>
<div class="paragraph">
<p>Compile</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>C:\Users\%username%\mod_proxy_cluster\native\build (main)
nmake</code></pre>
</div>
</div>
<div class="paragraph">
<p>Directory modules now contains all necessary modules:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>C:\Users\%username%\mod_proxy_cluster\native\build (main)
copy modules\*.so C:\Users\%username%\Apache24\modules\
'modules/mod_advertise.so' -&gt; 'C:/Users/karm/Apache24/modules/mod_advertise.so'
'modules/mod_manager.so' -&gt; 'C:/Users/karm/Apache24/modules/mod_manager.so'
'modules/mod_proxy_cluster.so' -&gt; 'C:/Users/karm/Apache24/modules/mod_proxy_cluster.so'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Done.</p>
</div>
</div>
<div class="sect3">
<h4 id="build-from-sources-on-linuxunix"><a class="link" href="#build-from-sources-on-linuxunix">4.7.2. Build from sources on Linux/Unix</a></h4>
<div class="paragraph">
<p>As for Windows, you can download the httpd bundle as well from <a href="https://dlcdn.apache.org/httpd/">here</a>.
Alternatively, you can use your distribution&#8217;s repositories (on Fedora, you can install httpd simply
by executing <code>dnf install httpd</code>), or you can build httpd from sources.</p>
</div>
<div class="paragraph">
<p>To build httpd-2.4.x from its sources see <a href="http://httpd.apache.org/docs/2.4/install.html">ASF httpd 2.4 doc</a>.</p>
</div>
<div class="paragraph">
<p>Download the sources and configure httpd with following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./configure --prefix=apache_installation_directory \
            --with-included-apr \
            --enable-proxy-ajp \
            --enable-so \
            --enable-proxy \
            --enable-proxy-http \
            --enable-proxy-hcheck \
            --with-port=8000 \
            --with-libxml2</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please bear in mind that the exact arguments/flags might differ based on your library choosing. Always
consult the documentation.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In case you want to use httpd for development purposes, you might find useful adding
<code>--enable-maintainer-mode</code> flag.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Build (<code>make</code>) and install (<code>make install</code>) httpd as configured.</p>
</div>
</div>
<div class="sect3">
<h4 id="build-the-modules-of-mod_proxy_cluster"><a class="link" href="#build-the-modules-of-mod_proxy_cluster">4.7.3. Build the modules of mod_proxy_cluster</a></h4>
<div class="paragraph">
<p>You need an httpd installation with mod_proxy (<code>--enable-proxy</code>) and ajp
protocol (<code>--enable-proxy-ajp</code>) enabled and with dso enabled (<code>--enable-so</code>).</p>
</div>
<div class="paragraph">
<p>Download the mod_proxy_cluster sources:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">git clone git://github.com/modcluster/mod_proxy_cluster.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>or download <a href="https://github.com/modcluster/mod_proxy_cluster/archive/main.zip">zipped main branch directly</a>.</p>
</div>
<div class="paragraph">
<p>Build the mod_proxy_cluster&#8217;s modules components, for each subdirectory
advertise, mod_manager and mod_proxy_cluster do following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">sh buildconf
./configure --with-apxs=apxs_file_location
make clean
make
cp *.so $APACHE_DIR/modules</code></pre>
</div>
</div>
<div class="paragraph">
<p>or alternatively using CMake:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># create a new subdirectory within native/ directory
mkdir build
cd build
cmake ..
make
cp modules/*so $APACHE_DIR/modules</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>$APACHE_DIR</code> is the location of the installed httpd.</p>
</div>
<div class="paragraph">
<p>The <a href="https://httpd.apache.org/docs/trunk/programs/apxs.html">apxs</a> file can be
found in your $APACHE_DIR/bin directory.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can ignore the libtool message on most platforms
(<code>libtool: install: warning: remember to run `libtool --finish $APACHE_DIR/modules'</code>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For mod_proxy_cluster 1.3.x you have to build mod_cluster_slotmem with the rest of modules.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once that is done use Apache httpd configuration to configure mod_proxy_cluster.</p>
</div>
</div>
<div class="sect3">
<h4 id="configuration-2"><a class="link" href="#configuration-2">4.7.4. Configuration</a></h4>
<div class="paragraph">
<p>A minimal configuration for mod_proxy_cluster to work is needed in httpd.
A listener must be added in JWS/Tomcat&#8217;s conf/server.xml.</p>
</div>
<div class="paragraph">
<p>The httpd.conf is located in <strong>httpd/conf/</strong> directory. To quickly test that
everything is in place, add the configuration from
<a href="#mod_proxy_cluster-2-x-with-apache-http-server-2-4-x">the minimal example</a>.</p>
</div>
<div class="paragraph">
<p>To start httpd do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">httpd/sbin/apachectl start</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Make sure to use SSL before going in production.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="security-configuration"><a class="link" href="#security-configuration">5. Security configuration</a></h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="https://github.com/modcluster/docs.modcluster.io/edit/main/docs/src/main/asciidoc/security.adoc">Improve this page – edit on GitHub.</a>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="using-ssl-in-mod_cluster"><a class="link" href="#using-ssl-in-mod_cluster">5.1. Using SSL in mod_cluster</a></h3>
<div class="paragraph">
<p>Forwarding SSL browser information when using http/https between httpd and JBossWEB:</p>
</div>
<div class="paragraph">
<p>There are 2 connections between the cluster and the front-end. Both
could be encrypted. That chapter describes how to encrypt both
connections.</p>
</div>
<div class="sect3">
<h4 id="using-ssl-between-jbossweb-and-httpd"><a class="link" href="#using-ssl-between-jbossweb-and-httpd">5.1.1. Using SSL between JBossWEB and httpd</a></h4>
<div class="paragraph">
<p>As the ClusterListener allows to configure httpd it is advised to use
SSL for that connection. The most easy is to use a virtual host that
will only be used to receive information from JBossWEB. Both side need
configuration.</p>
</div>
<div class="sect4">
<h5 id="apache-httpd-configuration-part"><a class="link" href="#apache-httpd-configuration-part">Apache httpd configuration part</a></h5>
<div class="paragraph">
<p><a href="http://httpd.apache.org/docs/2.4/mod/mod_ssl.html">mod_ssl</a> of httpd is using to do that.
See in one example how easy the configuration is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Listen 6666

&lt;VirtualHost 10.33.144.3:6666&gt;
    SSLEngine on
    SSLCipherSuite AES128-SHA:ALL:!ADH:!LOW:!MD5:!SSLV2:!NULL
    SSLCertificateFile conf/server.crt
    SSLCertificateKeyFile conf/server.key
    SSLCACertificateFile conf/server-ca.crt
    SSLVerifyClient require
    SSLVerifyDepth 10
&lt;/VirtualHost&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The conf/server.crt file is the PEM-encoded Certificate file for the
VirtualHost it must be signed by a Certificate Authority (CA) whose
certificate is stored in the sslTrustStore of the ClusterListener
parameter.</p>
</div>
<div class="paragraph">
<p>The conf/server.key file is the file containing the private key.</p>
</div>
<div class="paragraph">
<p>The conf/server-ca.crt file is the file containing the certificate of the
CA that have signed the client certificate JBossWEB is using. That is
the CA that have signed the certificate corresponding to the sslKeyAlias
stored in the sslKeyStore of the ClusterListener parameters.</p>
</div>
</div>
<div class="sect4">
<h5 id="clusterlistener-configuration-part"><a class="link" href="#clusterlistener-configuration-part">ClusterListener configuration part</a></h5>
<div class="paragraph">
<p>There is a <a href="developer/cluster_listener.html">ModCluster Listener</a> article
describing the SSL parameters of the ClusterListener. See in one example
how easy the configuration is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;Listener</span> <span class="attribute-name">className</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.web.cluster.ClusterListener</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">ssl</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">sslKeyStorePass</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeit</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">sslKeyStore</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/home/jfclere/CERTS/CA/test.p12</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">sslKeyStoreType</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PKCS12</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">sslTrustStore</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/home/jfclere/CERTS/CA/ca.p12</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">sslTrustStoreType</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">PKCS12</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">sslTrustStorePassword</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">changeit</span><span class="delimiter">&quot;</span></span>
          <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The sslKeyStore file contains the private key and the signed certificate
of the client certificate JBossWEB uses to connect to httpd. The
certificate must be signed by a Certificate Authority (CA) who certificate
is in the conf/server-ca.crt file of the httpd</p>
</div>
<div class="paragraph">
<p>The sslTrustStore file contains the CA certificate of the CA that signed
the certificate contained in conf/server.crt file.</p>
</div>
</div>
<div class="sect4">
<h5 id="mod-cluster-jboss-beans-configuration-part"><a class="link" href="#mod-cluster-jboss-beans-configuration-part">mod-cluster-jboss-beans configuration part</a></h5>
<div class="paragraph">
<p>The <code>mod-cluster-jboss-beans.xml</code> in
<code>$JBOSS_HOME/server/<strong>profile</strong>/deploy/mod-cluster.sar/META-INF</code> in the
ClusterConfig you are using you should have something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">ssl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>true<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sslKeyStorePass</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>changeit<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sslKeyStore</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>/home/jfclere/CERTS/test.p12<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sslKeyStoreType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>pkcs12<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sslTrustStore</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>/home/jfclere/CERTS/ca.p12<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sslTrustStoreType</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>pkcs12<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">sslTrustStorePassword</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>changeit<span class="tag">&lt;/property&gt;</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="how-the-different-files-were-created"><a class="link" href="#how-the-different-files-were-created">How the different files were created</a></h6>
<div class="paragraph">
<p>The files were created using OpenSSL utilities see
<a href="http://www.openssl.org/">OpenSSL</a> CA.pl (/etc/pki/tls/misc/CA for
example) has been used to create the test Certificate authority, the
certificate requests and private keys as well as signing the certificate
requests.</p>
</div>
</div>
<div class="sect5">
<h6 id="createca"><a class="link" href="#createca">Create the CA</a></h6>
<div class="paragraph">
<p>Create a work directory and work for there:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mkdir -p CERTS/Server
cd CERTS/Server</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create a new CA:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/etc/pki/tls/misc/CA -newca</code></pre>
</div>
</div>
<div class="paragraph">
<p>That creates a directory for example ../../CA that contains a
cacert.pem file which content have to be added to the
conf/server-ca.crt described above.</p>
</div>
<div class="paragraph">
<p>Export the CA certificate to a .p12 file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">openssl pkcs12 -export -nokeys -in ../../CA/cacert.pem -out ca.p12</code></pre>
</div>
</div>
<div class="paragraph">
<p>That reads the file cacert.pem that was created in the previous step
and convert it into a pkcs12 file the JVM is able to read.</p>
</div>
<div class="paragraph">
<p>That is the ca.p12 file used in the <em>sslTrustStore</em> parameter above.</p>
</div>
</div>
<div class="sect5">
<h6 id="createsc"><a class="link" href="#createsc">Create the server certificate</a></h6>
<div class="paragraph">
<p>Create a new request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/etc/pki/tls/misc/CA -newreq</code></pre>
</div>
</div>
<div class="paragraph">
<p>That creates 2 files named newreq.pem and newkey.pem. newkey.pem is
the file conf/server.key described above.</p>
</div>
<div class="paragraph">
<p>Sign the request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/etc/pki/tls/misc/CA -signreq</code></pre>
</div>
</div>
<div class="paragraph">
<p>That creates a file named newcert.pem. newcert.pem is the file
conf/server.crt described above. At that point you have created the
SSL stuff needed for the VirtualHost in httpd. You should use a
browser to test it after importing in the browser the content of the
cacert.pem file.</p>
</div>
</div>
<div class="sect5">
<h6 id="create-the-client-certificate"><a class="link" href="#create-the-client-certificate">Create the client certificate</a></h6>
<div class="paragraph">
<p>Create a work directory and work for there:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mkdir -p CERTS/Client
cd CERTS/Client</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create request and key for the JBossWEB part.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/etc/pki/tls/misc/CA -newreq</code></pre>
</div>
</div>
<div class="paragraph">
<p>That creates 2 files: Request is in newreq.pem, private key is in
newkey.pem</p>
</div>
<div class="paragraph">
<p>Sign the request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/etc/pki/tls/misc/CA -signreq</code></pre>
</div>
</div>
<div class="paragraph">
<p>That creates a file: newcert.pem</p>
</div>
<div class="paragraph">
<p>Don&#8217;t use a passphrase when creating the client certificate or remove
it before exporting:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">openssl rsa -in newkey.pem -out key.txt.pem
mv key.txt.pem newkey.pem</code></pre>
</div>
</div>
<div class="paragraph">
<p>Export the client certificate and key into a p12 file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">openssl pkcs12 -export -inkey newkey.pem -in newcert.pem -out test.p12</code></pre>
</div>
</div>
<div class="paragraph">
<p>That is the sslKeyStore file described above
(/home/jfclere/CERTS/CA/test.p12)</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="using-ssl-between-httpd-and-jbossweb"><a class="link" href="#using-ssl-between-httpd-and-jbossweb">Using SSL between httpd and JBossWEB</a></h5>
<div class="paragraph">
<p>Using https allows to encrypt communications between httpd and JBossWEB.
But due to the resources it needs that no advised to use it in high
load configuration.</p>
</div>
<div class="paragraph">
<p>(See <a href="developer/encrypting_connection.html">Encrypting connection between httpd
and TC</a> for detailed instructions).</p>
</div>
<div class="paragraph">
<p>httpd is configured to be a client for AS/TC, so it should provide a
certificate AS/TC will accept and have a private key to encrypt the
data, it also needs a CA certificate to valid the certificate AS/TC will
use for the connection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>SSLProxyEngine On
SSLProxyVerify require
SSLProxyCACertificateFile conf/cacert.pem
SSLProxyMachineCertificateFile conf/proxy.pem</code></pre>
</div>
</div>
<div class="paragraph">
<p>conf/proxy.pem should contain both key and certificate. The certificate
must be trusted by Tomcat via the CA in truststoreFile of
&lt;connector/&gt;.</p>
</div>
<div class="paragraph">
<p>conf/cacert.pem must contain the certificate of the CA that signed the
AS/TC certificate. The correspond key and certificate are the pair
specified by keyAlias and truststoreFile of the &lt;connector/&gt;. Of
course the &lt;connector/&gt; must be the https one (normally on port 8443).</p>
</div>
<div class="sect5">
<h6 id="how-the-different-files-were-created-2"><a class="link" href="#how-the-different-files-were-created-2">How the different files were created</a></h6>
<div class="paragraph">
<p>The files were created using OpenSSL utilities see
<a href="http://www.openssl.org/">OpenSSL</a> CA.pl (/etc/pki/tls/misc/CA for
example) has been used to create the test Certificate authority, the
certificate requests and private keys as well as signing the certificate
requests.</p>
</div>
</div>
<div class="sect5">
<h6 id="create-the-ca"><a class="link" href="#create-the-ca">Create the CA</a></h6>
<div class="paragraph">
<p>(See <a href="#createca">above</a>)</p>
</div>
</div>
<div class="sect5">
<h6 id="create-the-server-certificate"><a class="link" href="#create-the-server-certificate">Create the server certificate</a></h6>
<div class="paragraph">
<p>(See <a href="#createsc">above</a>)</p>
</div>
<div class="paragraph">
<p>The certificate and key need to be imported into the java keystore using
keytool</p>
</div>
<div class="paragraph">
<p>make sure you don&#8217;t use a passphrase for the key (don&#8217;t forget to clean
the file when done)</p>
</div>
<div class="paragraph">
<p>Convert the key and certificate to p12 file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">openssl pkcs12 -export -inkey key.pem -in newcert.pem -out test.p12</code></pre>
</div>
</div>
<div class="paragraph">
<p>make sure you use the keystore password as Export passphrase.</p>
</div>
<div class="paragraph">
<p>Import the contents of the p12 file in the keystore:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">keytool -importkeystore -srckeystore test.p12 -srcstoretype PKCS12</code></pre>
</div>
</div>
<div class="paragraph">
<p>Import the CA certificate in the java trust store: (Fedora 13 example).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">keytool -import -trustcacerts -alias &quot;caname&quot; -file  ../../CA/cacert.pem -keystore /etc/pki/java/cacerts</code></pre>
</div>
</div>
<div class="paragraph">
<p>Edit server.xml to have a &lt;connector/&gt; similar to:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;Connector</span> <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8443</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">protocol</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/1.1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">SSLEnabled</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">keyAlias</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">truststoreFile</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/etc/pki/java/cacerts</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">maxThreads</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">150</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scheme</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">https</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">secure</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">clientAuth</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">sslProtocol</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TLS</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Start TC/AS and use openssl s_client to test the connection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">openssl s_client -CAfile /home/jfclere/CA/cacert.pem -cert newcert.pem -key newkey.pem -host localhost -port 8443</code></pre>
</div>
</div>
<div class="paragraph">
<p>There shouldn&#8217;t be any error, and you should be able to see your CA
in the "Acceptable client certificate CA names".</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="forwarding-ssl-browser-information-when-using-httphttps-between-httpd-and-jbossweb"><a class="link" href="#forwarding-ssl-browser-information-when-using-httphttps-between-httpd-and-jbossweb">Forwarding SSL browser information when using http/https between httpd and JBossWEB</a></h5>
<div class="paragraph">
<p>When using http or https between httpd and JBossWEB you need to use the
SSLValve and export the SSL variable as header in the request in httpd.
If you are using AJP, mod_proxy_ajp will read the SSL variables and
forward them to JBossWEB automatically.</p>
</div>
<div class="paragraph">
<p>(See <a href="developer/mod_proxy_forwarding.html">Forwarding SSL environment when using
http/https proxy</a> for detailed instructions).</p>
</div>
<div class="paragraph">
<p>The SSL variable used by mod_proxy_ajp are the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>"HTTPS" SSL indicator.</p>
</li>
<li>
<p>"SSL_CLIENT_CERT" Chain of client certificates.</p>
</li>
<li>
<p>"SSL_CIPHER" The cipher used.</p>
</li>
<li>
<p>"SSL_SESSION_ID" The ID of the session.</p>
</li>
<li>
<p>"SSL_CIPHER_USEKEYSIZE" Size of the key used.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="demo"><a class="link" href="#demo">6. Load Balancing Demo Application</a></h2>
<div class="sectionbody">
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<a href="https://github.com/modcluster/docs.modcluster.io/edit/main/docs/src/main/asciidoc/demo.adoc">Improve this page – edit on GitHub.</a>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The demo application has not been recently updated and might not work with newer software versions as described below!
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="overview-2"><a class="link" href="#overview-2">6.1. Overview</a></h3>
<div class="paragraph">
<p>The mod_cluster distribution includes a demo application that helps
demonstrate how different server-side scenarios affect the routing of
client requests by the load balancer. The demo application is located in
the mod_cluster distribution&#8217;s demo directory.</p>
</div>
<div class="paragraph">
<p>The demo application consists of two components:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The first component is a war file that needs to be deployed in
JBossWeb/Tomcat/JBoss AS. The war includes a number of servlets.</p>
</li>
<li>
<p>The second component is a GUI application that allows a user to
launch a pool of threads that repeatedly make requests to the load
balancer. The requests are ultimately routed to the demo war&#8217;s
primary servlet. The application tracks which servers are handling
the requests and displays this information in a chart.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The application can also send separate requests to the demo war&#8217;s
load generation servlets, allowing the user to see how different
load conditions affect the balancing of requests.</p>
</div>
<div id="fn1link" class="paragraph">
<p>Note that the demo application does not actually depend on mod_cluster
in any way. Its only dependency is on JBossWeb/Tomcat.
 <a href="#fn1"><sup>[1]</sup></a>Consequently, the demo can be used to demonstrate
the effect of different server-side scenarios on the routing decisions
made by any load balancer, including mod_jk, mod_proxy or the various
hardware load balancers.</p>
</div>
<div class="paragraph">
<p>Note also that this demo application is not intended to be used as a
load testing tool; i.e. something that can demonstrate the maximum load
a cluster configuration can handle. Using it as such has a good chance
of showing you the maximum load the client can generate rather than the
maximum load your cluster can handle.</p>
</div>
</div>
<div class="sect2">
<h3 id="basic-usage"><a class="link" href="#basic-usage">6.2. Basic Usage</a></h3>
<div class="paragraph">
<p>To run the demo application:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Unpack the mod_cluster distribution on your filesystem. Here we
assume it has been unzipped to ~/mod_cluster or C:\mod_cluster.</p>
</li>
<li>
<p>Install mod_cluster into your httpd server as described at Installation of the httpd part</p>
</li>
<li>
<p>Install mod_cluster into your JBossAS/JBossWeb/Tomcat servers as
described at <a href="#install-the-worker-side-binaries">Installation on the Java
side</a></p>
</li>
<li>
<p>In AS7 you have to set org.apache.tomcat.util.ENABLE_MODELER to
true, Something like:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;system-properties&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.tomcat.util.ENABLE_MODELER</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/system-properties&gt;</span></code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start httpd and your JBossAS/JBossWeb/Tomcat servers</p>
</li>
<li>
<p>Deploy the application war file that you can find in demo/server/target/ and the name will
be mod_cluster-demo-server-&lt;mod_cluster-version&gt;-SNAPSHOT.war where you substitute the
mod_cluster&#8217;s version according to your distribution.</p>
</li>
<li>
<p>Start the demo application:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>On *nix:</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd ~/mod_cluster/demo/client/target/classes
./run-demo.sh</code></pre>
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>On Windows</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>C:\&gt; cd mod_cluster\demo\client\target\classes
C:\mod_cluster\demo\client&gt; run-demo</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/demo-client-control.jpg" alt="demo client control">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Configure the hostname and address of the httpd server, the number
of client threads, etc and click the "Start" button. See
<a href="#client-driver-configuration-options">Client Driver Configuration Options</a>
for details on the configuration options.</p>
</li>
<li>
<p>Switch to the "Request Balancing" tab to see how many requests are
going to each of your JBossAS/JBossWeb/Tomcat servers.</p>
</li>
</ol>
</div>
<div id="fn2link" class="olist arabic">
<ol class="arabic">
<li>
<p>Switch to the "Session Balancing" tab to see how many active sessions<a href="#fn2"><sup>[2]</sup></a>
are being hosted by each of your JBossAS/JBossWeb/Tomcat servers.</p>
</li>
<li>
<p>Stop some of your JBossAS/JBossWeb/Tomcat servers and/or undeploy
the load-demo.war from some of the servers and see the effect this
has on load balancing.</p>
</li>
<li>
<p>Restart some of your JBossAS/JBossWeb/Tomcat servers and/or
re-deploy the demo application to some of the servers and see the
effect this has on load balancing.</p>
</li>
<li>
<p>Experiment with adding artificial load to one or more servers to see
what effect that has on load balancing. See <a href="#load-generation-scenarios">Load
Generation Scenarios</a> for details.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Most of the various panels in application interface also present
information on the current status on any client threads. "Total Clients"
is the number of client threads created since the last time the "Start"
button was pushed. "Live Clients" is the number of threads currently
running. "Failed Clients" is the number of clients that terminated
abnormally; i.e. made a request that resulted in something other than an
HTTP 200 response.</p>
</div>
</div>
<div class="sect2">
<h3 id="client-driver-configuration-options"><a class="link" href="#client-driver-configuration-options">6.3. Client Driver Configuration Options</a></h3>
<div class="paragraph">
<p>The configuration of the client is driver is done via the application&#8217;s
"Clent Control" tab.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/demo-client-control.jpg" alt="demo client control">
</div>
</div>
<div class="paragraph">
<p>The panel includes the following options:</p>
</div>
<div id="fn3link" class="ulist">
<ul>
<li>
<p>Proxy Hostname: Hostname of the load balancer or the IP address on
which it is listening for requests<a href="#fn3"><sup>[3]</sup></a></p>
</li>
</ul>
</div>
<div id="fn4link" class="ulist">
<ul>
<li>
<p>Proxy Port: Port on which the load balancer is listening for
requests<a href="#fn4"><sup>[4]</sup></a></p>
</li>
<li>
<p>Context Path: Portion of the request URL that specifies the request
is for the load-demo.war</p>
</li>
<li>
<p>Session Life: Number of seconds a client thread should use a session
before invalidating or abandoning it. Generally it is good to keep
this to a small value; otherwise the use of session stickiness will
prevent changes in server load from affecting the load balancer&#8217;s
routing decisions. With sticky sessions enabled (strongly
recommended), it is the creation of a new session that allows the
load balancer to try to balance load.</p>
</li>
<li>
<p>Invalidate: Controls what the client thread should do when it stops
using a session because Session Life has passed. If checked, the
driver will send a request that results in the session being
invalidated. If unchecked, the session will just be abandoned, and
will continue to exist on the server until Session Timeout seconds
have passed. In the future this will likely be changed to a
percentage input, so X% can be invalidated, the rest abandoned.</p>
</li>
<li>
<p>Session Timeout: Number of seconds a session can remain unused
before the server is free to expire it. Unchecking Invalidate and
setting a high value relative to Session Life allows a significant
number of unused sessions to accumulate on the server.</p>
</li>
<li>
<p>Num Threads: Number of client threads to launch. Each thread
repeatedly makes requests until the "Stop" button is pushed or a
request receives a response other than HTTP 200.</p>
</li>
<li>
<p>Sleep Time: Number of ms the client threads should sleep between
requests.</p>
</li>
<li>
<p>Startup Time: Number of seconds over which the application should
stagger the start of the client threads. Staggering the start
advised as it avoids the unnatural situation where for the life of
the demonstation all sessions start at about the same time and then
are invalidated or abandoned at the same time. Staggering the start
allows the load balancer to continually see new sessions and decide
how to route them.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="load-generation-scenarios"><a class="link" href="#load-generation-scenarios">6.4. Load Generation Scenarios</a></h3>
<div class="paragraph">
<p>You can use the application&#8217;s GUI to instruct individual servers to
artificially generate various types of load, and then track how that
load affects request and session balancing. Load generation is
controlled via the application&#8217;s "Server Load Control" tab.</p>
</div>
<div class="paragraph">
<p>The panel includes the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Target Hostname and Target Port: The hostname or IP address of the
server on which you want load generated. There are two strategies
for setting these:</p>
</li>
<li>
<p>You can use the hostname and port of the load balancer, in which
case the load balancer will pick a backend server and route the
request to it. Note the client application does not maintain a
session cookie for these requests, so if you invoke another
server load generation request, you shouldn&#8217;t expect the same
server to handle it.</p>
</li>
<li>
<p>If the JBoss AS/JBossWeb/Tomcat servers are running the
HttpConnector as well as the AJP connector, you can specify the
address and port on which a particular server&#8217;s HttpConnector is
listening. The standard port is 8080.</p>
</li>
<li>
<p>Load Creation Action: Specifies the type of load the target server
should generate. See below for details on the available load types.</p>
</li>
<li>
<p>Params: Zero or more parameters to pass to the specified load
creation servlet. For example, in the screenshot above, Number of
Connections and Duration. How many parameters are displayed, their
name and their meaning depend on the selected Load Creation Action.
The label for each parameter includes a tooltip that explains its
use.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="images/demo-testhttpd.jpg" alt="demo testhttpd">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/demo-mod_cluster-manager.jpg" alt="demo mod cluster manager">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/demo-mod_cluster-manager-status.jpg" alt="demo mod cluster manager status">
</div>
</div>
<div class="paragraph">
<p>The available Load Creation Actions are as follows:</p>
</div>
<div class="dlist glossary">
<dl>
<dt>Active Sessions</dt>
<dd>
<p>    Generates server load by causing session creation on the target
server.</p>
</dd>
</dl>
</div>
<div class="dlist glossary">
<dl>
<dt>Datasource Use</dt>
<dd>
<p>    Generates server load by taking connections from the
java:DefaultDS datasource for a period</p>
</dd>
</dl>
</div>
<div class="dlist glossary">
<dl>
<dt>Connection Pool Use</dt>
<dd>
<p>    Generates server load by tieing up threads in the webserver
connections pool for a period</p>
</dd>
</dl>
</div>
<div class="dlist glossary">
<dl>
<dt>Heap Memory Pool Use</dt>
<dd>
<p>    Generates server load by filling 50% of free heap memory for a
period</p>
</dd>
</dl>
</div>
<div class="dlist glossary">
<dl>
<dt>CPU Use</dt>
<dd>
<p>Generates server CPU load by initiating a tight loop in a thread</p>
</dd>
</dl>
</div>
<div class="dlist glossary">
<dl>
<dt>Server Receive Traffic</dt>
<dd>
<p>    Generates server traffic receipt load by POSTing a large byte
array to the server once per second for a period</p>
</dd>
</dl>
</div>
<div class="dlist glossary">
<dl>
<dt>Server Send Traffic</dt>
<dd>
<p>    Generates server traffic send load by making a request once per
second to which the server responds with a large byte array</p>
</dd>
</dl>
</div>
<div class="dlist glossary">
<dl>
<dt>Request Count</dt>
<dd>
<p>    Generates server load by making numerous requests, increasing
the request count on the target server</p>
</dd>
</dl>
</div>
<hr>
<div class="dlist">
<dl>
<dt class="hdlist1"><a id="fn1"></a><sup><a href="#fn1link">[1</a>]</sup></dt>
<dd>
<p>The demo&#8217;s "Datasource Use" load generation scenario
requires the use of JBoss Application Server.</p>
</dd>
<dt class="hdlist1"><a id="fn2"></a><sup><a href="#fn2link">[2</a>]</sup></dt>
<dd>
<p>For purposes of this chart, a session is considered
"active" if a client thread will ever again send a request associated
with the session. When client threads stop using a session, they can
either send a request to invalidate it or just abandon it by no longer
including its session cookie in requests. After a session is abandoned,
it will not be reflected in the "Session Balancing" chart, but it will
continue to exist on the JBossWeb/Tomcat/JBoss AS server until it is
removed due to timeout.</p>
</dd>
<dt class="hdlist1"><a id="fn3"></a><sup><a href="#fn3link">[3</a>]</sup></dt>
<dd>
<p>The default value for this field is controlled by the
<code>mod_cluster.proxy.host</code> system property, or localhost if not
set. Editing the run-demo.sh or run-demo.bat file to change the
<code>-Dmod_cluster.proxy.host=localhost</code> passed to java will allow
you to avoid re-typing this value every time you launch the demo
application.</p>
</dd>
<dt class="hdlist1"><a id="fn4"></a><sup><a href="#fn4link">[4</a>]</sup></dt>
<dd>
<p>The default value for this field is controlled by the
<code>mod_cluster.proxy.port</code> system property, or 8000 if not set.
Editing the run-demo.sh or run-demo.bat file to change the
<code>-Dmod_cluster.proxy.port=8000</code> passed to java will allow you to
avoid re-typing this value every time you launch the demo application.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="faq"><a class="link" href="#faq">7. FAQ</a></h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="https://github.com/modcluster/docs.modcluster.io/edit/main/docs/src/main/asciidoc/faq.adoc">Improve this page – edit on GitHub.</a>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="what-is-advertise"><a class="link" href="#what-is-advertise">7.1. What is Advertise?</a></h3>
<div class="paragraph">
<p>Advertise allows autodiscovery of httpd proxies by the cluster nodes. It is done by sending multicast messages from httpd to the cluster.
The httpd specialized module: mod_advertise sends UDP message on a multicast group, both mod_advertise and the cluster listener joined the
multicast group and the cluster receives the messages.</p>
</div>
<div class="paragraph">
<p>Example of a mod_advertise message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>HTTP/1.0 200 OK
Date: Wed, 08 Apr 2009 12:26:32 GMT
Sequence: 16
Digest: f2d5f806a53effa6c67973d2ddcdd233
Server: 1b60092e-76f3-49fd-9f99-a51c69c89e2d
X-Manager-Address: 127.0.0.1:6666
X-Manager-Url: /bla
X-Manager-Protocol: http
X-Manager-Host: 10.33.144.3</code></pre>
</div>
</div>
<div class="paragraph">
<p>The X-Manager-Address header value is used by the cluster logic to send information about the cluster to the proxy.
It is the IP and port of the VirtualHost where mod_advertise is configured or URL parameter of the ServerAdvertise directive.</p>
</div>
<div class="paragraph">
<p>See <a href="#mod_advertise">mod_advertise</a> configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="what-to-do-if-i-dont-want-to-use-advertise-udp-multicast"><a class="link" href="#what-to-do-if-i-dont-want-to-use-advertise-udp-multicast">7.2. What to do if I don&#8217;t want to use Advertise (UDP multicast)</a></h3>
<div class="paragraph">
<p>In the VirtualHost receiving the MCMP of httpd.conf don&#8217;t use any
Advertise directive or set explicitly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>ServerAdvertise Off</code></pre>
</div>
</div>
<div class="paragraph">
<p>On the worker side, add the addresses and ports of the VirtualHost receiving MCMP (having <code>EnableMCMPReceive</code>) to the <code>proxyList</code>
property and set advertise to false, for example:</p>
</div>
<div class="sect3">
<h4 id="jboss-as-5"><a class="link" href="#jboss-as-5">7.2.1. JBoss AS 5</a></h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">proxyList</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>10.33.144.3:6666,10.33.144.1:6666<span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">advertise</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>false<span class="tag">&lt;/property&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>in <code>jboss-as/server/production/deploy/mod-cluster.sar/META-INF/mod-cluster-jboss-beans.xml</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="tomcat-678-and-jbossweb"><a class="link" href="#tomcat-678-and-jbossweb">7.2.2. Tomcat 6/7/8 and JBossWeb</a></h4>
<div class="paragraph">
<p>In <code>server.xml</code>, change</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;Listener</span> <span class="attribute-name">className</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.container.catalina.standalone.ModClusterListener</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>to</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;Listener</span> <span class="attribute-name">className</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.jboss.modcluster.container.catalina.standalone.ModClusterListener</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">advertise</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">false</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">proxyList</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">10.33.144.3:6666,10.33.144.1:6666</span><span class="delimiter">&quot;</span></span>
<span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="it-is-not-working-what-should-i-do"><a class="link" href="#it-is-not-working-what-should-i-do">7.3. It is not working, what should I do?</a></h3>
<div class="paragraph">
<p>Please, at first, go through the following check-list. Set Apache HTTP Server&#8217;s <code>LogLevel debug</code> in <code>httpd.conf</code> and
read the <code>error_log</code>. If you get stuck, you are welcome to</p>
</div>
<div class="ulist">
<ul>
<li>
<p>post on JBoss user forums</p>
</li>
<li>
<p>join JBoss mailing list and and drop us a line</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="there-is-no-error-in-the-error_log"><a class="link" href="#there-is-no-error-in-the-error_log">7.3.1. There is no error in the error_log</a></h4>
<div class="paragraph">
<p>That happens when Advertise is not working and no Proxy List is configured: The worker nodes do not get the from Apache HTTP Server.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check that the modules are loaded and Advertise is started. In httpd.conf activate extended information display, add:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>AllowDisplay On</code></pre>
</div>
</div>
<div class="paragraph">
<p>When accessing the mod_cluster-manager console you should get something like: TODO: Image.
 If not, go to the Minimal Example and add the missing directive(s).</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Check that Advertise message are received on the cluster node.
A <a href="https://github.com/modcluster/mod_proxy_cluster/blob/main/test/java/Advertize.java">Java utility</a>
could be used to check Advertise. It is in the <a href="https://github.com/modcluster/mod_proxy_cluster">mod_proxy_cluster repository</a>
and can be compiled using javac. The output should be something like:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>[jfclere@jfcpc java]$ java Advertize 224.0.1.105 23364
ready waiting…
received: HTTP/1.0 200 OK
Date: Mon, 28 Jun 2010 07:30:31 GMT
Sequence: 1
Digest: df8a4321fa99e5098174634f2fe2f87c
Server: 1403c3be-837a-4e76-85b1-9dfe5ddb4378
X-Manager-Address: test.example.com:6666
X-Manager-Url: /1403c3be-837a-4e76-85b1-9dfe5ddb4378
X-Manager-Protocol: http
X-Manager-Host: test.example.com</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>If there are no Advertise messages, check the firewall. Advertise uses UDP port 23364 and multicast address 224.0.1.105 by default.
Furthermore, <strong>do not bind to localhost/127.0.0.1</strong>, use a non-localhost IP address for your balancer – workers UDP
advertisement test.</p>
</li>
<li>
<p>If you are unable to get the Advertisement to work, try it first without it, with a static configuration without UDP multicast).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="error-in-server-log-or-catalina-out"><a class="link" href="#error-in-server-log-or-catalina-out">7.3.2. Error in server.log or catalina.out</a></h4>
<div class="ulist">
<ul>
<li>
<p><code>IO error sending command</code>:  Check the firewall and error_log, if there is nothing in the error_log then it is a firewall problem.
If you have something like:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>INFO [DefaultMCMPHandler] IO error sending command INFO to proxy jfcpc/10.33.144.3:8888</code></pre>
</div>
</div>
<div class="paragraph">
<p>it means that the worker was unable to <strong>contact the balancer</strong>. Keep in mind that the communication is <strong>bidirectional</strong>.</p>
</div>
<div class="paragraph">
<p>You can use telnet hostname/address port to check that it is OK, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">[jfclere@jfcpc docs]$ telnet 10.33.144.3 8888
Trying 10.33.144.3…
Connected to jfcpc.
Escape character is '^]'.
GET /
<span class="tag">&lt;html&gt;</span><span class="tag">&lt;body&gt;</span><span class="tag">&lt;h1&gt;</span>It works!<span class="tag">&lt;/h1&gt;</span><span class="tag">&lt;/body&gt;</span><span class="tag">&lt;/html&gt;</span>Connection closed by foreign host.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Check that the address and port are the expected ones you may use
ServerAdvertise directive in you mod_cluster httpd configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">ServerAdvertise On http://localhost:6666</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="error-in-error_log"><a class="link" href="#error-in-error_log">7.3.3. Error in error_log</a></h4>
<div class="ulist">
<ul>
<li>
<p><code>client denied by server configuration</code>: The directory in the VirtualHost is not allowed for the client. If you have something like:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>[error] [client 10.33.144.3] client denied by server configuration: /</code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to have something like the undermentioned authentication configured in the <code>EnableMCMPReceive</code> marked VirtualHost:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>&lt;Location /&gt;
    Require ip 10.33.144.3
&lt;/Location&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="i-started-mod_cluster-and-it-looks-like-its-using-only-one-of-the-workers"><a class="link" href="#i-started-mod_cluster-and-it-looks-like-its-using-only-one-of-the-workers">7.4. I started mod_cluster and it looks like it&#8217;s using only one of the workers?</a></h3>
<div class="paragraph">
<p>One must give the system some time, in matter of the amount of new sessions created, to settle and pick other nodes.
An example from an actual environment: You have 3 nodes with the following Load values:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Node jboss-6,   Load: 20
Node jboss-6-2, Load: 90
Node jboss-6-3, Load:  1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Yes, this means that jboss-6-2 is almost not loaded at all whereas jboss-6-3 is desperately overloaded.
Now, I send 1001 requests, each representing a new session (the client is forgetting cookies). The distribution of the requests will be as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Node jboss-6   served 181 requests
Node jboss-6-2 served 811 requests
Node jboss-6-3 served   9 requests</code></pre>
</div>
</div>
<div class="paragraph">
<p>So, generally, yes, the least loaded box received by far the greatest amount of requests, but it did not receive them all. Furthermore, and this concerns your case, for some time from the start, it was jboss-6 who was getting requests.</p>
</div>
<div class="paragraph">
<p>This whole magic is in place in order to prevent congestion.</p>
</div>
</div>
<div class="sect2">
<h3 id="keep-seeing-http1-1-501-method-not-implemented"><a class="link" href="#keep-seeing-http1-1-501-method-not-implemented">7.5. Keep seeing "HTTP/1.1 501 Method Not Implemented"</a></h3>
<div class="paragraph">
<p>The <code>EnableMCMPReceive</code> must be configured in the <code>VirtualHost</code> where the MCMP elements are configured in the Apache httpd configuration.
See minimal example above.</p>
</div>
</div>
<div class="sect2">
<h3 id="redirect-is-not-working-tomcat-jbossweb"><a class="link" href="#redirect-is-not-working-tomcat-jbossweb">7.6. Redirect is not working (Tomcat, JBossWeb):</a></h3>
<div class="paragraph">
<p>When using http/https instead of AJP, proxyname, proxyhost and redirect must be configured in the Tomcat Connector. Something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;Connector</span> <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">protocol</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/1.1</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">connectionTimeout</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">20000</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">proxyName</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">httpd_host_name</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">proxyPort</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8000</span><span class="delimiter">&quot;</span></span>
           <span class="attribute-name">redirectPort</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">443</span><span class="delimiter">&quot;</span></span>
<span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="i-have-more-than-one-tomcatjbossweb-connector"><a class="link" href="#i-have-more-than-one-tomcatjbossweb-connector">7.7. I have more than one Tomcat/JBossWeb Connector</a></h3>
<div class="paragraph">
<p>mod_cluster tries to use the first AJP connector configured. If there
is not any AJP connector, it uses the http or https that has the biggest
maxthreads value. That is <code>maxThreads</code> in Tomcat 6/7/8 and JBoss AS 5/6:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;Connector</span> <span class="attribute-name">port</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8080</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">protocol</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/1.1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">maxThreads</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">201</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Or <code>max-connections</code> in JBoss AS 7: (32 * processor + 1 for native and 512 * processor + 1 for JIO).</p>
</div>
<div class="paragraph">
<p>In Web subsystem:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;connector</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">protocol</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">HTTP/1.1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">scheme</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">socket-binding</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">max-connections</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">513</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="chrome-does-not-display-mod_cluster-manager-page"><a class="link" href="#chrome-does-not-display-mod_cluster-manager-page">7.8. Chrome does not display /mod_cluster-manager page</a></h3>
<div class="paragraph">
<p>When using Chrome with mod_cluster-manager, the page is not displayed
and the following error is displayed instead:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Error 312 (net::ERR_UNSAFE_PORT): Unknown error.</code></pre>
</div>
</div>
<div class="paragraph">
<p>you can change the port of the VirtualHost to 7777 or any value chrome accepts or add:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code> –explicitly-allowed-ports=6666</code></pre>
</div>
</div>
<div class="paragraph">
<p>to the start parameters of Chrome.</p>
</div>
</div>
<div class="sect2">
<h3 id="how-do-i-use-mod_cluster-with-selinux"><a class="link" href="#how-do-i-use-mod_cluster-with-selinux">7.9. How do I use mod_cluster with SELinux?</a></h3>
<div class="paragraph">
<p>mod_cluster needs to open port and create shared memory and files, therefore some permissions have to be added,
you need to configure something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>policy_module(mod_cluster, 1.0)

require {
 type unconfined_java_t;
 type httpd_log_t;
 type httpd_t;
 type http_port_t;
 class udp_socket node_bind;
 class file write;
}

# ============= httpd_t ==============

allow httpd_t httpd_log_t:file write;
corenet_tcp_bind_generic_port(httpd_t)
corenet_tcp_bind_soundd_port(httpd_t)
corenet_udp_bind_generic_port(httpd_t)
corenet_udp_bind_http_port(httpd_t)

# ============= unconfined_java_t ==============

allow unconfined_java_t http_port_t:udp_socket node_bind;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Put the above in a file for example <code>mod_cluster.te</code> and generate the
<code>mod_cluster.pp</code> file (for example in Fedora 16):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>[jfclere@jfcpc docs]$ make -f /usr/share/selinux/devel/Makefile
Compiling targeted mod_cluster module
/usr/bin/checkmodule: loading policy configuration from tmp/mod_cluster.tmp
/usr/bin/checkmodule: policy configuration loaded
/usr/bin/checkmodule: writing binary representation (version 14) to tmp/mod_cluster.mod
Creating targeted mod_cluster.pp policy package
rm tmp/mod_cluster.mod.fc tmp/mod_cluster.mod</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>mod_cluster.pp</code> file should be proceeded by <code>semodule</code> as root:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>[root@jfcpc docs]# semodule -i mod_cluster.pp
[root@jfcpc docs]#</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, one may use <code>semanage</code> and add ports and paths labels manually.</p>
</div>
</div>
<div class="sect2">
<h3 id="how-do-i-change-status-message-frequency"><a class="link" href="#how-do-i-change-status-message-frequency">7.10. How do I change STATUS message frequency?</a></h3>
<div class="paragraph">
<p>In WildFly, this behavior is configurable in the mod_cluster subsystem.
Run the following CLI command to adjust to 20 seconds in this example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/subsystem=modcluster/proxy=default:write-attribute(name=status-interval, value=20)</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Tomcat, you need to use system property to modify this behavior.
Setting <code>org.jboss.modcluster.container.catalina.status-frequency</code> (default: 1) makes worker to send STATUS MCMP messages only <code>1/n</code> periodic event.
The events occur every <code>backgroundProcessorDelay</code> <em>(default 10 seconds)</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="how-can-i-debug-requests-in-undertow"><a class="link" href="#how-can-i-debug-requests-in-undertow">7.11. How can I debug requests in Undertow?</a></h3>
<div class="paragraph">
<p>Undertow by default provides a <code>RequestDumpingHandler</code> from the main <code>io.undertow.core</code> module.
Use the following CLI script to configure Undertow to log the request to the log:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>batch
/subsystem=undertow/configuration=filter/custom-filter=request-dumping-filter:add(class-name=io.undertow.server.handlers.RequestDumpingHandler, module=io.undertow.core)
/subsystem=undertow/server=default-server/host=default-host/filter-ref=request-dumping-filter:add
run-batch
reload</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="migration-2"><a class="link" href="#migration-2">8. Migration</a></h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<a href="https://github.com/modcluster/docs.modcluster.io/edit/main/docs/src/main/asciidoc/migration.adoc">Improve this page – edit on GitHub.</a>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="migration-from-mod_jk"><a class="link" href="#migration-from-mod_jk">8.1. Migration from mod_jk</a></h3>
<div class="paragraph">
<p>The mod_cluster only support Apache httpd, there are no plans to support IIS nor IPlanet.</p>
</div>
<div class="paragraph">
<p>The migration from mod_jk to mod_cluster is not very complex.
Only very few worker properties can&#8217;t be mapped to mod_cluster parameters.</p>
</div>
<div class="paragraph">
<p>Here is the table of worker properties and how to transfer them in the ClusterListener parameters.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">mod_jk worker property</th>
<th class="tableblock halign-left valign-top">ClusterListener parameter</th>
<th class="tableblock halign-left valign-top">Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It is read from the &lt;Connector/&gt; Address information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It is read from the &lt;Connector/&gt; Port information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It is read from the &lt;Connector/&gt; Protocol information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">route</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">It is read from the &lt;Engine/&gt; JVMRoute information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domain</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">That is not supported in this version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">redirect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The nodes with loadfactor = 0 are standby nodes they will be used no other nodes are available</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">socket_timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nodeTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default 10 seconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">socket_keepalive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KEEP_ALIVE os is always on in mod_cluster</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connection_pool_size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The max size is calculated to be AP_MPMQ_MAX_THREADS+1 (max)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connection_pool_minsize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">smax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default is max</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connection_pool_timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ttl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time to live when over smax connections. The default is 60 seconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">workerTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max time to wait for a free worker default 1 second</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">retries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxAttempts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max retries before returning an error Default: 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">recovery_options</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mod_cluster behave like mod_jk with value 7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">fail_on_status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max_packet_size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">iobuffersize/receivebuffersize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not supported in this version. Use ProxyIOBufferSize</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max_reply_timeouts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">recovery_time</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The ClusterListener will tell (via a STATUS message) mod_cluster that the node is up again</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">activation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mod_cluster receives this information via ENABLE/DISABLE/STOP messages</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">distance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mod_cluster handles this via the loadfactor logic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The context "mounted" automatically via the ENABLE-APP messages. ProxyPass could be used too</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">secret</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connect_timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not supported. Use ProxyTimeout or server TimeOut (Default 300 seconds)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">prepost_timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default 10 seconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">reply_timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not supported. Use ProxyTimeout or server TimeOut? directive (Default 300 seconds)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="migration-from-mod_proxy"><a class="link" href="#migration-from-mod_proxy">8.2. Migration from mod_proxy</a></h3>
<div class="paragraph">
<p>As <code>mod_cluster</code> is a sophisticated balancer, migration from <code>mod_proxy</code> to <code>mod_cluster</code> is straightforward.
The <code>mod_cluster</code> replaces a reverse proxy with load-balancing.
A reverse proxy is configured such as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>ProxyRequests Off

&lt;Proxy *&gt;
  Order deny,allow
  Allow from all
&lt;/Proxy&gt;

ProxyPass /foo http://foo.example.com/bar
ProxyPassReverse /foo http://foo.example.com/bar</code></pre>
</div>
</div>
<div class="paragraph">
<p>All the general proxy parameters could be used in <code>mod_cluster</code> they work like in <code>mod_proxy</code>,
only the balancers and the workers definitions are slightly different.</p>
</div>
<div class="sect3">
<h4 id="workers"><a class="link" href="#workers">8.2.1. Workers</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">mod_proxy Parameter</th>
<th class="tableblock halign-left valign-top">ClusterListener parameter</th>
<th class="tableblock halign-left valign-top">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">min</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not supported in this version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mod_cluster uses mod_proxy default value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">smax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">smax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as mod_proxy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ttl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ttl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as mod_proxy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">acquire</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">workerTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as mod_proxy acquire but in seconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">disablereuse</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mod_cluster will disable the node in case of error and the ClusterListener will for the reuse via the STATUS message</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flushPackets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flushPackets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as mod_proxy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">flushwait</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flushwait</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as mod_proxy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">keepalive</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always on: OS KEEP_ALIVE is always used. Use connectionTimeout in the &lt;Connector&gt; if needed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lbset</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as mod_proxy Default value 10 seconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lbfactor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The load factor is received by mod_cluster from a calculated value in the ClusterListener</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">redirect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not supported lbfactor sent to 0 makes a standby node</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">retry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ClusterListener will test when the node is back online</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">route</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JVMRoute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">In fact JBossWEB via the JVMRoute in the Engine will add it</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mod_cluster has a finer status handling: by context via the ENABLE/STOP/DISABLE/REMOVE application messages. hot-standby is done by lbfactor = 0 and Error by lbfactor = 1 both values are sent in STATUS message by the ClusterListener</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">nodeTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default wait forever (<a href="http://httpd.apache.org/docs/2.4/mod/mod_proxy.html">http://httpd.apache.org/docs/2.4/mod/mod_proxy.html</a> is wrong there)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ttl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ttl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default 60 seconds</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="balancers"><a class="link" href="#balancers">8.2.2. Balancers</a></h4>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">mod_proxy Parameter</th>
<th class="tableblock halign-left valign-top">ClusterListener parameter</th>
<th class="tableblock halign-left valign-top">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lbmethod</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">There is only one load balancing method in mod_cluster "cluster_byrequests"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxattempts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxAttempts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nofailover</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">stickySessionForce</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Same as in mod_proxy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stickysession</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">StickySessionCookie/StickySessionPath</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The 2 parameters in the ClusterListener are combined in one that behaves like in mod_proxy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">workerTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default 1 seconds</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="developer-resources"><a class="link" href="#developer-resources">9. Developer Resources</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>For more technical and detailed information, such as the ModCluster Management Protocol (MCMP) definition,
visit <a href="https://docs.modcluster.io/developer/">Developer Resources</a> page.</p>
</div>
</div>
</div>
</div>
</body>
</html>